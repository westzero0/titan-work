<!DOCTYPE html>
<html lang="ko">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>íƒ€ì´íƒ„ ê´€ë¦¬ì íŒ¨ë„</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
  <style>
    :root { --primary-color: #2563eb; --bg-color: #f8f9fa; }
    body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-color); margin: 0; padding: 0; overflow: hidden; }

      button:active {
    opacity: 0.8;
    transform: scale(0.98);
}
      
   /* --- ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ê³µí†µ ìš”ì†Œ --- */
.header { background: #fff; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #ddd; position: fixed; top:0; width: 100%; z-index: 100; }

.swiper { 
    width: 100%; 
    height: calc(100vh - 130px); /* ğŸŸ¢ ë†’ì´ ê³„ì‚°ê°’ë„ ì‚´ì§ ì¡°ì • (ë‚´ë¹„ë°” ê³µê°„ í™•ë³´) */
    margin-top: 65px; /* ğŸŸ¢ ê¸°ì¡´ 50pxì—ì„œ 65pxë¡œ ì¦ê°€ */
}

.card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
h3 { margin-top: 0; color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 10px; }

label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; color: #444; }
input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
button { width: 100%; padding: 15px; margin-top: 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; }

/* 1. í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜: ê°•ë ¥ ê³ ì • ë° ê·¸ë˜í”½ ê°€ì† ì ìš© */
.bottom-nav {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 65px;
    background: #fff;
    display: flex;
    border-top: 1px solid #ddd;
    z-index: 2147483647 !important; /* ë¬´ì¡°ê±´ ë§¨ ìœ„ë¡œ */
    transform: translateZ(0);       /* ìŠ¤ì™€ì´í”„ ì‹œ ê¹œë¹¡ì„ ë°©ì§€ */
    -webkit-transform: translateZ(0);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    touch-action: none;
}

/* 2. ìŠ¬ë¼ì´ë“œ ì—¬ë°±: ë‚´ë¹„ê²Œì´ì…˜ì— ê°€ë ¤ì§€ì§€ ì•Šê²Œ í•˜ë‹¨ ì—¬ë°± í™•ë³´ */
.swiper-slide { 
    overflow-y: auto; 
    padding: 15px 12px; 
    box-sizing: border-box; 
    padding-bottom: 90px !important; /* 65px(ë‚´ë¹„) + ì—¬ìœ  */
    background-color: #f1f5f9; 
}
    
    
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; font-size: 11px; cursor: pointer; }
.nav-item.active { color: var(--primary-color); }
.nav-item i { font-size: 20px; margin-bottom: 4px; }

/* [í˜„ì¥ í˜„í™© ê´€ë¦¬ - ì¹´ë“œ ë± ìŠ¤íƒ€ì¼] */
    
    /* 1. ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ìœ„ì¹˜ ì¡ê¸° */
    #client-management-list {
        width: 100%;
        padding-bottom: 30px; /* í•˜ë‹¨ ì—¬ë°± */
    }

    /* 2. ìŠ¤ì™€ì´í¼ ìŠ¬ë¼ì´ë“œ (ì¹´ë“œ í•œ ì¥ì˜ í¬ê¸° ì„¤ì •) */
    .client-management-swiper .swiper-slide {
        width: 90% !important;  /* ğŸŸ¢ í™”ë©´ì˜ 90%ë§Œ ì°¨ì§€ (ì˜† ì¹´ë“œê°€ ì‚´ì§ ë³´ì„) */
        margin: 0 auto;         /* ê°€ìš´ë° ì •ë ¬ */
        background: transparent; 
        padding: 10px 5px;      /* ê·¸ë¦¼ì ì˜ë¦¬ì§€ ì•Šê²Œ ì—¬ë°± í™•ë³´ */
    }

    /* 3. ê±°ë˜ì²˜ ì¹´ë“œ ë””ìì¸ (ë…ë¦½ëœ ì¹´ë“œ ëŠë‚Œ) */
    .client-card {
        background: #fff;
        border-radius: 20px;    /* ë‘¥ê¸€ê²Œ */
        box-shadow: 0 4px 15px rgba(0,0,0,0.08); /* ğŸŸ¢ ê·¸ë¦¼ì ì¶”ê°€í•´ì„œ ë¶• ë„ì›€ */
        border: none !important; 
        overflow: hidden;       /* ë‚´ìš© ë„˜ì¹¨ ë°©ì§€ */
        min-height: 300px;
    }

    /* 4. ê±°ë˜ì²˜ í—¤ë” (ë””ìì¸ ê°•í™”) */
    .client-header {
        background: #2563eb;    /* ğŸŸ¢ íŒŒë€ìƒ‰ ë°°ê²½ìœ¼ë¡œ ê°•ì¡° */
        padding: 15px 20px;
        font-size: 1.2rem;
        font-weight: 800;
        color: #fff;            /* ê¸€ììƒ‰ í°ìƒ‰ */
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* 5. í˜„ì¥ ë¦¬ìŠ¤íŠ¸ í–‰ */
    .site-row {
        padding: 18px 20px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* 6. í˜„ì¥ ì´ë¦„ & ì£¼ì†Œ */
    .site-name { 
        font-size: 1.1rem; 
        font-weight: bold; 
        color: #333; 
        margin-bottom: 6px; 
    }
    .site-addr { 
        font-size: 0.9rem; 
        color: #64748b; 
        cursor: pointer; 
        display: flex; 
        align-items: center; 
        gap: 5px; 
    }

.swiper-pagination-bullet-active { background: #2563eb !important; }

/* --- ì§ì› ê´€ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ --- */
#worker-list-admin { display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; }
.worker-card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border-top: 4px solid #ddd; position: relative; display: block; }
.worker-card .name { font-size: 1.1rem; font-weight: bold; color: #333; }
.status-badge { font-size: 0.75rem; padding: 3px 8px; border-radius: 20px; color: #fff; font-weight: bold; }
.status-on { background: #2563eb; }
.status-off { background: #ef4444; }
.info { margin-top: 10px; font-size: 0.9rem; line-height: 1.6; color: #555; }
.copyable { color: #2563eb; text-decoration: underline; cursor: pointer; word-break: break-all; }
.card-btns { margin-top: 15px; display: flex; gap: 8px; }



    /* 1. ì¹© ë””ìì¸ (ê¸€ì ê¸¸ì´ì— ë§ê²Œ ìë™ ì¡°ì ˆ) */
    .chip {
        padding: 8px 16px; 
        background: #fff; 
        border: 1px solid #e2e8f0; 
        border-radius: 25px; /* ë” ë‘¥ê¸€ê²Œ */
        font-size: 0.9rem; 
        color: #64748b; 
        cursor: pointer; 
        margin-right: 6px; 
        margin-bottom: 8px; 
        display: inline-flex; /* ë‚´ìš©ë¬¼ë§Œí¼ ë„ˆë¹„ ì°¨ì§€ */
        align-items: center; 
        transition: all 0.2s;
        font-weight: 500;
    }
    .chip:hover { background-color: #f8fafc; }
    
    /* ì„ íƒëœ ì¹© (íŒŒë€ìƒ‰) */
    .chip.active {
        background: #eff6ff; 
        color: #2563eb; 
        border-color: #bfdbfe; 
        font-weight: bold;
    }

    /* ì‚­ì œ ëª¨ë“œì¼ ë•Œ ì¹© ìŠ¤íƒ€ì¼ (ë¹¨ê°„ í…Œë‘ë¦¬) */
    .chip.delete-mode {
        border-color: #fca5a5;
        background: #fef2f2;
        color: #ef4444;
        animation: shake 0.3s; /* ì‚´ì§ í”ë“¤ë¦¼ íš¨ê³¼ */
    }

    /* 2. í—¤ë” + ì‚­ì œ ë²„íŠ¼ ì¤„ */
    .header-row {
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-top: 20px; 
        margin-bottom: 8px;
    }
    .delete-toggle {
        font-size: 0.85rem; 
        color: #ef4444; 
        cursor: pointer; 
        display: flex; 
        align-items: center; 
        gap: 4px;
        padding: 4px 8px;
        border-radius: 6px;
    }
    .delete-toggle:hover { background: #fef2f2; }

    /* 3. ì…ë ¥ì°½ + ì¶”ê°€ ë²„íŠ¼ ê·¸ë£¹ */
    .input-with-btn {
        display: flex; 
        gap: 8px; 
        margin-bottom: 12px;
    }
    .input-with-btn input {
        margin-top: 0; 
        flex: 1;
    }
    .btn-add-chip {
        width: auto; 
        padding: 0 20px; 
        margin-top: 0; 
        background: #334155; /* ì§„í•œ íšŒìƒ‰ (ì°¸ê³  ì´ë¯¸ì§€ ìƒ‰ìƒ) */
        color: white; 
        border-radius: 8px; 
        font-weight: bold; 
        cursor: pointer;
    }
    
    /* 4. ë°•ìŠ¤ í…Œë‘ë¦¬ ì œê±°ìš© */
    .no-border-box {
        border: none !important; 
        background: transparent !important; 
        padding: 0 !important; 
        box-shadow: none !important;
    }

    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-2px); }
        50% { transform: translateX(2px); }
        75% { transform: translateX(-2px); }
        100% { transform: translateX(0); }
    }
    

    /* ì¼ì •ë“±ë¡ íŒì—… ëª¨ë‹¬ ë°°ê²½ */
.modal {
    display: none; 
    position: fixed; z-index: 1000; left: 0; top: 0;
    width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);
}

/* íŒì—…ì°½ ë³¸ì²´ */
.modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.close {
    color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
}

/* ê°„ë‹¨í•œ ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
#calendar-container {
  padding: 0;                   /* ğŸŸ¢ ì—¬ë°± 0ìœ¼ë¡œ ì„¤ì • (ê½‰ ì°¨ê²Œ) */
    background: #fff;
    min-height: 300px;
    text-align: center;
}

/* [ëª¨ë°”ì¼ ë‹¬ë ¥ ìµœì í™” ìŠ¤íƒ€ì¼] */
    
    /* 1. ë‹¬ë ¥ íˆ´ë°”(ë…„ì›” ì œëª©, ë²„íŠ¼) í¬ê¸° ì¡°ì ˆ */
    .fc .fc-toolbar-title {
        font-size: 1.1rem !important; /* ì œëª© í¬ê¸° ì ë‹¹íˆ */
    }
    .fc .fc-button {
        padding: 4px 8px !important;  /* ë²„íŠ¼ ì—¬ë°± ì¶•ì†Œ */
        font-size: 0.85rem !important; /* ë²„íŠ¼ ê¸€ì ì¶•ì†Œ */
    }

    /* 2. ë‚ ì§œ ìˆ«ì í¬ê¸° ì¶•ì†Œ */
    .fc .fc-daygrid-day-top {
        flex-direction: row; /* ìˆ«ì ì •ë ¬ */
    }
    .fc-daygrid-day-number {
        font-size: 0.8rem !important; /* ë‚ ì§œ ìˆ«ì ì¤„ì„ */
        padding: 4px !important;
        color: #64748b;
    }

    /* 3. ì¼ì • ë§‰ëŒ€(Event Bar) ìµœì í™” - ìš”ì²­í•˜ì‹  ë¶€ë¶„! */
    .fc-event {
        margin-top: 1px !important; /* ë§‰ëŒ€ ê°„ ê°„ê²© ì¢í˜ */
        border-radius: 3px !important;
    }
    
    .fc-event-main {
        padding: 1px 2px !important; /* ë§‰ëŒ€ ë‚´ë¶€ ì—¬ë°± ìµœì†Œí™” */
    }

    .fc-event-title {
        font-size: 0.7rem !important; /* ğŸŸ¢ ê¸€ì í¬ê¸° í™• ì¤„ì„ (11~12px ìˆ˜ì¤€) */
        font-weight: normal !important; /* ë‘êº¼ìš´ ê¸€ì”¨ í•´ì œí•´ì„œ ê³µê°„ í™•ë³´ */
        line-height: 1.1 !important;
        white-space: nowrap !important; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
        overflow: hidden !important;
        text-overflow: ellipsis !important; /* ê¸¸ë©´ ... ì²˜ë¦¬ */
    }

    /* 4. ì¼ìš”ì¼/í† ìš”ì¼ ìƒ‰ìƒ */
    .fc-day-sun .fc-daygrid-day-number { color: #ef4444 !important; }
    .fc-day-sat .fc-daygrid-day-number { color: #2563eb !important; }
    
    /* 5. ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡° (ë°°ê²½ìƒ‰ ì—°í•˜ê²Œ) */
    .fc-day-today {
        background-color: #f8fafc !important;
    }
    
    
  </style>
  
</head>


    
<body>
  <div class="header">âš¡ íƒ€ì´íƒ„ í†µí•© ê´€ë¦¬ì</div>


    <div class="swiper">
  <div class="swiper-wrapper">
    <div class="swiper-slide">

        
    <div class="card">
    <h3>ğŸ‘¤ ì‹ ê·œ ì¸ì› ë“±ë¡</h3>
    <input type="text" id="new-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)">
    <select id="new-role">
        <option value="ê¸°ê³µ">ê¸°ê³µ</option>
        <option value="ì¡°ê³µ">ì¡°ê³µ</option>
    </select>
    <input type="number" id="new-rate" placeholder="ì¼ë‹¹ (ìˆ«ìë§Œ)">
    <input type="text" id="new-phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ (ì˜ˆ: 010-1234-5678)">
    <input type="text" id="new-address" placeholder="ì§‘ì£¼ì†Œ">
    <input type="password" id="new-pw" placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)" maxlength="4">
    <button class="btn-blue" onclick="addWorker()">ë“±ë¡í•˜ê¸°</button>
</div>
   

    <div class="card">
        <h3>ğŸ‘¥ ì§ì› ê´€ë¦¬</h3>
        <div id="worker-list-admin">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
     </div>

      <div class="swiper-slide">
     <div class="card">
    <h3>ğŸ¢ ê±°ë˜ì²˜ ë° í˜„ì¥ ë“±ë¡</h3>
    
    <div class="copy-hint" style="margin-bottom:8px;">ê¸°ì¡´ ê±°ë˜ì²˜ ì„ íƒ (ë˜ëŠ” ì§ì ‘ ì…ë ¥)</div>
    <div id="client-chips" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px;">
        </div>
    
    <div class="input-group">
        <label>ê±°ë˜ì²˜ëª…</label>
        <input type="text" id="c_client" placeholder="ì¹©ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    
    <div class="input-group">
        <label>í˜„ì¥ëª…</label>
        <input type="text" id="c_site" placeholder="í˜„ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    
    <div class="input-group">
        <label>í˜„ì¥ ì£¼ì†Œ</label>
        <input type="text" id="c_addr" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (Dì—´ ì €ì¥)">
    </div>
    
    <button class="btn-blue" onclick="saveClient()" style="width:100%">í˜„ì¥ ë“±ë¡í•˜ê¸°</button>
</div>
        <h3 style="margin: 25px 10px 10px 10px; color:#1e293b; font-size:1.1rem;">
            ğŸ“‹ í˜„ì¥ í˜„í™© <span style="font-size:0.8rem; color:#94a3b8; font-weight:normal;">(ì¢Œìš°ë¡œ ë„˜ê²¨ë³´ì„¸ìš”)</span>
        </h3>
        
        <div id="client-management-list"></div>
        
    </div>

    <div class="swiper-slide">
      <div class="card">
        <h3>ğŸ“¦ ìì¬ ë§ˆìŠ¤í„° ë“±ë¡</h3>
        <label>ëŒ€ë¶„ë¥˜</label><input type="text" id="m_cat">
        <label>í’ˆëª©</label><input type="text" id="m_name">
        <label>ê·œê²©</label><input type="text" id="m_spec">
        <label>ë‹¨ìœ„</label><input type="text" id="m_unit">
        <label>ë‹¨ê°€</label><input type="number" id="m_price">
        <button onclick="saveMaterial()">ìì¬ í’ˆëª© ë“±ë¡</button>
      </div>
    </div>


    
   <div class="swiper-slide">
        <div style="padding: 20px 10px 10px 10px;">
            <h3 style="margin:0; color:#1e293b;">ğŸ“… ì‘ì—… ì¼ì •</h3>
            <p style="margin:5px 0 0 0; font-size:0.8rem; color:#64748b;">
                ë‚ ì§œ í´ë¦­: ë“±ë¡ / ë°” í´ë¦­: ìˆ˜ì •
            </p>
        </div>

        <div id="calendar-container" style="background:white; border-top:1px solid #e2e8f0; border-bottom:1px solid #e2e8f0; margin-bottom: 30px;"></div>

        <div class="card" style="margin: 0 10px 100px 10px;">
            <h4 style="margin:0 0 15px 0; color:#334155;">ğŸ“‹ ë‹¤ê°€ì˜¤ëŠ” ìƒì„¸ ì¼ì •</h4>
            <div id="upcoming-list"></div>
        </div>

     
<div id="schedule-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
            <h3 id="modal-date-title" style="margin:0; color:#2563eb;">ì¼ì • ìˆ˜ì •</h3>
            <span class="close" onclick="closeModal()" style="font-size:2rem;">&times;</span>
        </div>
        
        <input type="hidden" id="sched-row-id">
        <input type="hidden" id="sched-date">
        <input type="hidden" id="sched-end-date">
        <input type="hidden" id="sched-client">
        <input type="hidden" id="sched-site">
        <input type="hidden" id="sched-shift">
        <input type="hidden" id="sched-workers-text">
        <input type="hidden" id="sched-car">
        <input type="hidden" id="sched-content">

        <div class="input-group">
            <label>ğŸ¢ ê±°ë˜ì²˜ (ì§„í–‰ì¤‘ì¸ í˜„ì¥)</label>
            <div id="sched-client-chips-area" style="display:flex; flex-wrap:wrap; margin-bottom:10px;"></div>

            <label>ğŸ—ï¸ í˜„ì¥ ì„ íƒ</label>
            <div id="sched-site-chips-area" style="min-height:40px; margin-bottom:15px; display:flex; flex-wrap:wrap;">
                <span style="color:#aaa; font-size:0.9rem;">ê±°ë˜ì²˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</span>
            </div>

            <label>â° ê·¼ë¬´ í˜•íƒœ</label>
            <div id="shift-toggle-btn" onclick="toggleShift()" style="background:#3b82f6; color:white; padding:12px; text-align:center; border-radius:8px; font-weight:bold; cursor:pointer; font-size:1.1rem; margin-bottom:20px;">
                ğŸŒ ì£¼ê°„
            </div>

            <label>ğŸ‘· íˆ¬ì… ì¸ì› <span id="worker-count-display">(0ëª…)</span></label>
            <div id="worker-chips-area" class="no-border-box" style="display:flex; flex-wrap:wrap; padding:10px 0;">
                </div>

            <div class="header-row">
                <label style="margin:0;">ğŸš› ì‚¬ìš© ì°¨ëŸ‰ (ì¤‘ë³µ ê°€ëŠ¥)</label>
                <div class="delete-toggle" onclick="toggleDeleteMode('car')">ğŸ—‘ï¸ ì‚­ì œ</div>
            </div>
            <div class="input-with-btn">
                <input type="text" id="new-car-input" placeholder="ì°¨ëŸ‰ ì¶”ê°€">
                <button class="btn-add-chip" onclick="addPreset('car')">ì¶”ê°€</button>
            </div>
            <div id="car-chips-area" class="no-border-box" style="display:flex; flex-wrap:wrap; margin-bottom:10px;"></div>

            <div class="header-row">
                <label style="margin:0;">ğŸ“ ì‘ì—… ë‚´ìš© (ê³µì • ì„ íƒ)</label>
                <div class="delete-toggle" onclick="toggleDeleteMode('work')">ğŸ—‘ï¸ ì‚­ì œ</div>
            </div>
            <div class="input-with-btn">
                <input type="text" id="new-work-input" placeholder="ê³µì • ì¶”ê°€ (ì˜ˆ: ë°°ê´€)">
                <button class="btn-add-chip" onclick="addPreset('work')">ì¶”ê°€</button>
            </div>
            <div id="work-preset-list" class="no-border-box" style="display:flex; flex-wrap:wrap; margin-bottom:10px;"></div>
            
            <label>íŠ¹ì´ì‚¬í•­</label>
            <textarea id="sched-note" rows="2" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥"></textarea>
            
            <div style="display:flex; gap:10px; margin-top:30px;">
                <button type="button" id="btn-save" onclick="saveSchedule('add')" style="flex:2;">ì €ì¥</button>
                <button type="button" id="btn-update" onclick="saveSchedule('update')" style="flex:2; display:none;">ìˆ˜ì •</button>
                <button type="button" id="btn-delete" onclick="deleteSchedule()" style="flex:1; display:none; background:#fee2e2; color:#ef4444;">ì‚­ì œ</button>
            </div>
        </div>
    </div>
  </div>
     
     
      
    </div>

       </div>
</div>

<div class="bottom-nav" id="main-nav">
    <div class="nav-item active" onclick="jumpTo(0)">ğŸ‘¥ <span>ì¸ì›</span></div>
    <div class="nav-item" onclick="jumpTo(1)">ğŸ¢ <span>ê±°ë˜ì²˜</span></div>
    <div class="nav-item" onclick="jumpTo(2)">ğŸ“¦ <span>ìì¬</span></div>
    <div class="nav-item" onclick="jumpTo(3)">ğŸ“… <span>ì¼ì •</span></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    
      
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbx0r8IPhDytW9knWTEbsFRVK4HmFj5CynrD9TlXzIbOe_aSDotaATcnSzouC845NIBx/exec"; // ğŸ‘ˆ ê¼­ ë³¸ì¸ ì£¼ì†Œë¡œ ìˆ˜ì •í•˜ì„¸ìš”!
// ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ì—ëŸ¬ ë°©ì§€ìš©)
    let calendar = null;
    let swiper = null;
    let globalScheduleData = [];
    let globalClientData = [];
    let globalWorkerData = [];
    let selectedWorkerSet = new Set(); // ì¸ì› ì„ íƒìš©
    let selectedWorkSet = new Set();   // ê³µì • ì„ íƒìš©
let globalTitanData = {}; // ğŸ‘ˆ ì´ í•œ ì¤„ì´ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë‚œ ê²ë‹ˆë‹¤!

    // [1] ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', async () => {
        initSwiper();
        try {
            console.log("ë°ì´í„° ë¡œë“œ ì‹œì‘...");
            await Promise.all([loadAdminData(), loadClientManagement(), loadScheduleData()]);
            console.log("ë°ì´í„° ë¡œë“œ ì™„ë£Œ");
            initCalendar();
            renderScheduleList();
        } catch (e) {
            console.error("ë¡œë”© ì‹¤íŒ¨:", e);
            initCalendar();
        }
    });

    // [2] ìŠ¤ì™€ì´í¼
    function initSwiper() {
        const el = document.querySelector('.swiper');
        if (!el) return;
        swiper = new Swiper('.swiper', {
            speed: 400, loop: false, allowTouchMove: true,
            noSwiping: true, noSwipingClass: 'swiper-no-swiping',
            on: { slideChange: function () { updateNav(this.activeIndex); } }
        });
    }
    function jumpTo(index) { if (swiper) swiper.slideTo(index); }
    function updateNav(index) {
        document.querySelectorAll('.nav-item').forEach((item, i) => {
            if (i === index) item.classList.add('active'); else item.classList.remove('active');
        });
    }

    // [3] ë‹¬ë ¥
    function initCalendar() {
        const el = document.getElementById('calendar-container');
        if (!el) return;
        const events = globalScheduleData.map(item => ({
            id: item.rowId,
            title: `${item.site} (${item.workers ? item.workers.split(',').length : 0}ëª…)`,
            start: item.date,
            backgroundColor: item.shift === 'ì•¼ê°„' ? '#475569' : '#3b82f6',
            borderColor: 'transparent', extendedProps: item
        }));

        if (calendar) calendar.destroy();
        calendar = new FullCalendar.Calendar(el, {
            initialView: 'dayGridMonth', locale: 'ko', height: 'auto',
            longPressDelay: 300, eventLongPressDelay: 300, selectLongPressDelay: 300,
            headerToolbar: { left: 'prev', center: 'title', right: 'next' },
            dayCellContent: (info) => ({ html: info.dayNumberText.replace('ì¼', '') }),
            selectable: true, selectMirror: true,
            select: (info) => openModal('add', info.startStr, null, info.endStr),
            eventClick: (info) => openModal('edit', null, info.event.extendedProps),
            events: events
        });
        calendar.render();
    }

   // [ìƒì„¸ ì¼ì • ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ìˆ˜ì •]
    function renderScheduleList() {
        // ğŸ”´ [ìˆ˜ì •] HTMLì— ìˆëŠ” ì •í™•í•œ IDì¸ 'upcoming-list'ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.
        const box = document.getElementById('upcoming-list'); 
        
        if (!box) return; // ì—†ìœ¼ë©´ ì¡°ìš©íˆ ì¢…ë£Œ (ì—ëŸ¬ ë°©ì§€)

        const today = new Date().toISOString().split('T')[0];
        // globalScheduleDataê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ì²˜ë¦¬
        const scheduleData = Array.isArray(globalScheduleData) ? globalScheduleData : [];

        const list = scheduleData
            .filter(i => i.date >= today)
            .sort((a, b) => new Date(a.date) - new Date(b.date));

        if (list.length === 0) {
            box.innerHTML = '<div style="padding:20px; text-align:center; color:#999;">ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        box.innerHTML = list.map(item => `
            <div class="card" style="position:relative; margin-bottom:15px; padding:15px; border-left:5px solid ${item.shift==='ì•¼ê°„'?'#475569':'#2563eb'};" 
                 onclick='openModal("edit", null, ${JSON.stringify(item).replace(/'/g, "&#39;")})'>
                
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div>
                        <div style="font-weight:bold; font-size:0.9rem; color:#334155;">
                            ${item.date} (${item.shift})
                        </div>
                        <div style="font-size:1.1rem; font-weight:800; color:#1e293b; margin:3px 0;">${item.site}</div>
                         <div style="font-size:0.85rem; color:#64748b;">ğŸ¢ ${item.client}</div>
                    </div>
                </div>

                <div style="display:flex; flex-wrap:wrap; gap:5px; margin-top:8px;">
                    ${(item.workers || '').split(',').map(name => `<span style="background:#f1f5f9; padding:2px 8px; border-radius:12px; font-size:0.8rem; color:#475569;">${name.trim()}</span>`).join('')}
                    ${item.car ? `<span style="font-size:0.8rem; color:#2563eb; font-weight:bold; margin-left:5px;">ğŸš› ${item.car}</span>` : ''}
                </div>
            </div>
        `).join('');
    }
      

    // [5] ëª¨ë‹¬ ì—´ê¸° (í•µì‹¬ ë¡œì§ í†µí•©)
    function openModal(mode, dateStr, data, endStr = null) {
        const modal = document.getElementById('schedule-modal');
        if (!modal) return;
        modal.style.display = 'block';

        try {
            if (mode === 'add') {
                document.getElementById('sched-date').value = dateStr;
                document.getElementById('sched-end-date').value = endStr || "";
                let title = dateStr + " ì¼ì • ë“±ë¡";
                if (endStr) {
                    const diff = (new Date(endStr) - new Date(dateStr)) / (1000 * 60 * 60 * 24);
                    if (diff > 1) title = `${dateStr} ~ (${Math.ceil(diff)}ì¼ê°„)`;
                }
                document.getElementById('modal-date-title').innerText = title;
                resetForm();
                
                // ëª¨ë“  ì¹© ì´ˆê¸°í™”
                renderChips('', '');
                renderWorkerChips("");
                renderVehicleChips("");
                initWorkPresets("");
                currentShiftIndex = 0; updateShiftBtn();

                document.getElementById('btn-save').style.display = 'block';
                document.getElementById('btn-update').style.display = 'none';
                document.getElementById('btn-delete').style.display = 'none';
            } else {
                document.getElementById('modal-date-title').innerText = "ì¼ì • ìˆ˜ì •";
                document.getElementById('sched-row-id').value = data.rowId;
                document.getElementById('sched-date').value = data.date;
                document.getElementById('sched-end-date').value = "";
                document.getElementById('sched-note').value = data.note || "";

                const shiftIdx = SHIFT_TYPES.indexOf(data.shift);
                currentShiftIndex = shiftIdx >= 0 ? shiftIdx : 0;
                updateShiftBtn();

                renderChips(data.client, data.site);
                renderWorkerChips(data.workers || "");
                renderVehicleChips(data.car || "");
                initWorkPresets(data.content || "");

                document.getElementById('btn-save').style.display = 'none';
                document.getElementById('btn-update').style.display = 'block';
                document.getElementById('btn-delete').style.display = 'block';
            }
        } catch (err) {
            console.error("Modal Error:", err);
            alert("íŒì—…ì„ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
        }
    }

    function closeModal() { document.getElementById('schedule-modal').style.display = "none"; }
    function resetForm() {
        ['sched-client', 'sched-site', 'sched-workers-text', 'sched-car', 'sched-content', 'sched-note', 'worker-search-input', 'new-work-input'].forEach(id => {
            const el = document.getElementById(id); if(el) el.value = "";
        });
        selectedWorkerSet.clear();
        selectedWorkSet.clear();
    }

    // [6] ì¹© ë¡œì§ë“¤
    // 6-1. ê±°ë˜ì²˜ (ì§„í–‰ì¤‘ë§Œ)
    function renderChips(sClient, sSite) {
        const cBox = document.getElementById('sched-client-chips-area');
        const sBox = document.getElementById('sched-site-chips-area');
        if(!cBox || !sBox) return;

        const activeData = globalClientData.filter(item => item.status !== 'ì™„ë£Œ' || (item.client === sClient && item.site === sSite));
        const uniques = [...new Set(activeData.map(i => i.client))];

        cBox.innerHTML = uniques.map(c => `<div class="chip ${c === sClient ? 'active' : ''}" onclick="clkClient(this, '${c}')">${c}</div>`).join('');
        document.getElementById('sched-client').value = sClient || "";

        if (sClient) {
            const sites = activeData.filter(i => i.client === sClient);
            sBox.innerHTML = sites.map(s => `<div class="chip ${s.site === sSite ? 'active' : ''}" onclick="clkSite(this, '${s.site}')">${s.site}</div>`).join('');
            document.getElementById('sched-site').value = sSite || "";
        } else {
            sBox.innerHTML = '<span style="color:#aaa; font-size:0.8rem;">ê±°ë˜ì²˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</span>';
        }
    }
    function clkClient(el, name) { document.getElementById('sched-client').value = name; renderChips(name, ''); }
    function clkSite(el, name) { 
        document.getElementById('sched-site').value = name; 
        Array.from(el.parentNode.children).forEach(c => c.classList.remove('active'));
        el.classList.add('active');
    }

  // [2] ì¸ì› ì„ íƒ (ê²€ìƒ‰ì°½ ì—†ì´ ì¹©ìœ¼ë¡œë§Œ êµ¬ì„±)
    function renderWorkerChips(namesStr) {
        const container = document.getElementById('worker-chips-area');
        const countDisplay = document.getElementById('worker-count-display');
        selectedWorkerSet.clear();
        if (namesStr) namesStr.split(',').map(s=>s.trim()).forEach(n => { if(n) selectedWorkerSet.add(n); });

        countDisplay.innerText = `(${selectedWorkerSet.size}ëª…)`;
        document.getElementById('sched-workers-text').value = Array.from(selectedWorkerSet).join(', ');

        if(container) {
            container.innerHTML = globalWorkerData.filter(w => w.status === 'ì¬ì§').map(w => {
                const isSelected = selectedWorkerSet.has(w.name);
                return `<div class="chip ${isSelected ? 'active' : ''}" 
                             onclick="toggleWorkerSelection('${w.name}')">
                            ${w.name}${isSelected ? ' âœ•' : ''}
                        </div>`;
            }).join('');
        }
    }
    function toggleWorkerSelection(name) {
        if (selectedWorkerSet.has(name)) selectedWorkerSet.delete(name);
        else selectedWorkerSet.add(name);
        renderWorkerChips(Array.from(selectedWorkerSet).join(', '));
    }
      

      
    function filterWorkerChips() {
        const input = document.getElementById('worker-search-input').value.toLowerCase();
        document.querySelectorAll('.worker-candidate').forEach(chip => {
            const name = chip.getAttribute('data-name');
            if (selectedWorkerSet.has(name)) { chip.style.display = "none"; return; }
            chip.style.display = name.toLowerCase().includes(input) ? "inline-flex" : "none";
        });
    }
    function addWorkerToSelection(name) {
        selectedWorkerSet.add(name);
        const cand = document.querySelector(`.worker-candidate[data-name="${name}"]`);
        if(cand) cand.style.display = "none";
        renderSelectedBox();
    }
    function removeWorkerFromSelection(name) {
        selectedWorkerSet.delete(name);
        const cand = document.querySelector(`.worker-candidate[data-name="${name}"]`);
        if(cand) cand.style.display = "inline-flex";
        filterWorkerChips(); renderSelectedBox();
    }
    function renderSelectedBox() {
        const box = document.getElementById('selected-workers-box');
        const cnt = document.getElementById('worker-count-display');
        const list = Array.from(selectedWorkerSet);
        if(cnt) cnt.innerText = `(${list.length}ëª…)`;
        document.getElementById('sched-workers-text').value = list.join(', ');
        
        if (list.length === 0) box.innerHTML = '<span style="color:#aaa; font-size:0.8rem; padding:5px;">ì•„ë˜ ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ê²€ìƒ‰í•˜ì„¸ìš”.</span>';
        else box.innerHTML = list.map(n => `<div class="chip" style="background:#e0f2fe; color:#0369a1; border:1px solid #7dd3fc; gap:5px;">${n} <span onclick="removeWorkerFromSelection('${n}')" style="cursor:pointer; font-weight:bold;">&times;</span></div>`).join('');
    }

  // [3] ì°¨ëŸ‰ & ê³µì • ì¹© ë Œë”ë§ (ì¶”ê°€/ì‚­ì œ UI í†µí•©)
    function renderVehicleChips(currentVal) {
        const box = document.getElementById('car-chips-area');
        const selected = currentVal ? currentVal.split(',').map(s=>s.trim()) : [];
        box.innerHTML = vehicleList.map(item => {
            const isActive = selected.includes(item);
            const modeClass = deleteMode.car ? 'delete-mode' : (isActive ? 'active' : '');
            const action = deleteMode.car ? `removePreset('car', '${item}')` : `toggleSelection('car', '${item}')`;
            return `<div class="chip ${modeClass}" onclick="${action}">${item}${deleteMode.car ? ' âŒ' : (isActive ? ' âœ•' : '')}</div>`;
        }).join('');
        document.getElementById('sched-car').value = selected.join(', ');
    }

      
    function toggleCar(el, name) {
        el.classList.toggle('active');
        const all = document.querySelectorAll('#car-chips-area .chip.active');
        document.getElementById('sched-car').value = Array.from(all).map(c=>c.innerText).join(', ');
    }

    // 6-4. ê³µì • (íƒœê·¸ ë°©ì‹)
    const WORK_PRESETS = ["ì–‘ì¤‘", "í¬ì„¤", "ë‹¨ë§", "íŠ¸ë ˆì´", "ì…ì„ ", "ê²°ì„ ", "ìŠ¤í‹¸ë°°ê´€", "ë ˆì´ìŠ¤ì›¨ì´", "ì² ê±°", "ìì¬ì •ë¦¬", "ì²­ì†Œ"];
function initWorkPresets(currentVal) {
        selectedWorkSet.clear();
        
        // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¹©ìœ¼ë¡œ ë§Œë“¤ê¸°
        if(currentVal) {
            currentVal.split(',').map(s=>s.trim()).forEach(t => { 
                if(t) selectedWorkSet.add(t); 
            });
        }
        
        // ğŸŸ¢ [ìˆ˜ì •] ì…ë ¥ì°½ì´ ì§„ì§œ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ê°’ì„ ë¹„ì›€ (ì—ëŸ¬ ì›ì²œ ì°¨ë‹¨)
        const inp = document.getElementById('new-work-input');
        if (inp) {
            inp.value = ""; 
        }
        
        renderWorkPresets();
    }
      
   function renderWorkPresets(currentVal) {
        const box = document.getElementById('work-preset-list');
        const selected = currentVal ? currentVal.split(',').map(s=>s.trim()) : [];
        box.innerHTML = workList.map(item => {
            const isActive = selected.includes(item);
            const modeClass = deleteMode.work ? 'delete-mode' : (isActive ? 'active' : '');
            const action = deleteMode.work ? `removePreset('work', '${item}')` : `toggleSelection('work', '${item}')`;
            return `<div class="chip ${modeClass}" onclick="${action}">${item}${deleteMode.work ? ' âŒ' : (isActive ? ' âœ•' : '')}</div>`;
        }).join('');
        document.getElementById('sched-content').value = selected.join(', ');
    }
      

      
    function addWorkTag(t) { selectedWorkSet.add(t); renderWorkPresets(); }
    function removeWorkTag(t) { selectedWorkSet.delete(t); renderWorkPresets(); }
    function addNewWorkTag() {
        const inp = document.getElementById('new-work-input');
        const val = inp.value.trim();
        if(val) { selectedWorkSet.add(val); inp.value = ""; renderWorkPresets(); }
    }

    // 7. ì €ì¥/ì‚­ì œ
    async function saveSchedule(mode) {
        const payload = {
            date: document.getElementById('sched-date').value,
            client: document.getElementById('sched-client').value,
            site: document.getElementById('sched-site').value,
            shift: document.getElementById('sched-shift').value,
            workers: document.getElementById('sched-workers-text').value,
            car: document.getElementById('sched-car').value,
            content: document.getElementById('sched-content').value,
            note: document.getElementById('sched-note').value
        };
        if(!payload.client || !payload.site) return alert("ê±°ë˜ì²˜ì™€ í˜„ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");

        let action = 'addSchedule';
        let dataToSend = payload;
        const endDateStr = document.getElementById('sched-end-date').value;

        if (mode === 'add' && endDateStr) {
            action = 'addScheduleBatch';
            const list = [];
            let cur = new Date(payload.date);
            const end = new Date(endDateStr);
            while(cur < end) {
                list.push({...payload, date: cur.toISOString().split('T')[0]});
                cur.setDate(cur.getDate()+1);
            }
            dataToSend = list;
        } else if (mode === 'update') {
            action = 'updateSchedule';
            payload.rowId = document.getElementById('sched-row-id').value;
        }
        await sendToGas(action, dataToSend);
        closeModal();
    }
    async function deleteSchedule() {
        if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const rowId = document.getElementById('sched-row-id').value;
        await sendToGas('deleteSchedule', { rowId });
        closeModal();
    }

    // UI Helper
    const SHIFT_TYPES = ['ì£¼ê°„', 'ì•¼ê°„', 'ì¡°ì¶œ'];
    let currentShiftIndex = 0;
    function toggleShift() { currentShiftIndex = (currentShiftIndex + 1) % SHIFT_TYPES.length; updateShiftBtn(); }
    function updateShiftBtn() {
        const s = SHIFT_TYPES[currentShiftIndex];
        document.getElementById('sched-shift').value = s;
        const btn = document.getElementById('shift-toggle-btn');
        btn.innerText = (s === 'ì£¼ê°„' ? 'ğŸŒ ' : s === 'ì•¼ê°„' ? 'ğŸŒ™ ' : 'ğŸŒ… ') + s;
        btn.style.backgroundColor = s === 'ì£¼ê°„' ? '#3b82f6' : (s === 'ì•¼ê°„' ? '#475569' : '#f59e0b');
    }

    // ì„œë²„ í†µì‹ 
    async function sendToGas(action, data) {
        try {
            const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action, data }), redirect: 'follow' });
            const text = await res.text();
            if (text.includes("SUCCESS")) {
                alert("âœ… ì™„ë£Œ!");
                if(action.includes('Schedule')) { await loadScheduleData(); initCalendar(); renderScheduleList(); }
                else if(action.includes('Worker')) loadAdminData();
                else loadClientManagement();
                
                if(action === 'adminAddClient') { document.getElementById('c_client').value = ""; document.getElementById('c_site').value = ""; document.getElementById('c_addr').value = ""; }
            } else alert("âš ï¸ " + text);
        } catch (e) { alert("í†µì‹  ì—ëŸ¬: " + e.message); }
    }

    async function loadScheduleData() { const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: 'getScheduleList' }) }); globalScheduleData = await res.json(); }

      // [ì§ì› ê´€ë¦¬] ìƒì„¸ ì •ë³´ í‘œì‹œ ê¸°ëŠ¥ ë³µêµ¬
          async function loadAdminData() { 
        const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: 'getAllWorkerInfo' }) }); 
        globalWorkerData = await res.json(); 
        
        const box = document.getElementById('worker-list-admin');
        if (box) {
            box.innerHTML = globalWorkerData.map(w => `
                <div class="worker-card" style="border-top: 4px solid ${w.status === 'ì¬ì§' ? '#2563eb' : '#ef4444'}; background:#fff; border-radius:12px; padding:15px; box-shadow:0 2px 5px rgba(0,0,0,0.05); margin-bottom:15px;">
                    
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div class="name" style="font-size:1.1rem; font-weight:bold;">
                            ${w.name} <span style="font-size:0.8rem; font-weight:normal; color:#666;">(${w.role})</span>
                        </div>
                        <span class="status-badge" style="background:${w.status === 'ì¬ì§' ? '#2563eb' : '#ef4444'}; color:#fff; padding:3px 8px; border-radius:20px; font-size:0.75rem; font-weight:bold;">
                            ${w.status}
                        </span>
                    </div>

                    <div class="info" style="font-size:0.9rem; color:#555; line-height:1.6;">
                        <div onclick="copyText('${w.phone}')" style="cursor:pointer; display:flex; align-items:center;">
                            ğŸ“± ${w.phone || '<span style="color:#aaa">ë²ˆí˜¸ ì—†ìŒ</span>'}
                        </div>
                        <div onclick="copyText('${w.address}')" style="cursor:pointer; margin-top:4px; display:flex; align-items:center;">
                            ğŸ  ${w.address || '<span style="color:#aaa">ì£¼ì†Œ ì—†ìŒ</span>'}
                        </div>
                        
                        <div style="margin-top:8px; display:flex; justify-content:space-between; border-top:1px solid #f1f5f9; padding-top:8px;">
                            <span style="font-weight:bold; color:#333;">ğŸ’° ${Number(w.rate).toLocaleString()}ì›</span>
                            <span style="background:#f1f5f9; padding:2px 6px; border-radius:4px; font-size:0.85rem;">ğŸ”‘ ${w.pw}</span>
                        </div>
                    </div>

                    <div class="card-btns" style="margin-top:15px; display:flex; gap:8px;">
                        <button onclick="changePassword('${w.name}')" style="flex:1; padding:8px; font-size:0.85rem; background:#fff; border:1px solid #ddd; color:#333; margin-top:0; border-radius:6px; cursor:pointer;">
                            ë¹„ë²ˆë³€ê²½
                        </button>
                        <button onclick="updateStatus('${w.name}', '${w.status === 'ì¬ì§' ? 'í‡´ì‚¬' : 'ì¬ì§'}')" style="flex:1; padding:8px; font-size:0.85rem; background:${w.status === 'ì¬ì§' ? '#fee2e2' : '#e0f2fe'}; color:${w.status === 'ì¬ì§' ? '#ef4444' : '#0284c7'}; border:none; margin-top:0; border-radius:6px; cursor:pointer; font-weight:bold;">
                            ${w.status === 'ì¬ì§' ? 'í‡´ì§ì²˜ë¦¬' : 'ë³µêµ¬í•˜ê¸°'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

      
    }  
      
    // [ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ ìˆ˜ì •]
    async function loadClientManagement() {
        const listContainer = document.getElementById('client-management-list');
        if(listContainer) listContainer.innerHTML = '<div style="text-align:center; padding:20px;">â³ í˜„ì¥ ë°ì´í„° ë¡œë”© ì¤‘...</div>';

        try {
            // 1. ì„œë²„ì— ë°ì´í„° ìš”ì²­
            const res = await fetch(GAS_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'getTitanData' }) // ë˜ëŠ” 'getAllData' (ê¸°ì¡´ì— ì“°ì‹œë˜ ì•¡ì…˜ëª… í™•ì¸ í•„ìš”)
            });
            
            // 2. ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (í•µì‹¬!)
            const data = await res.json();
            globalTitanData = data;  // ğŸ‘ˆ ì—¬ê¸°ì„œ ë°ì´í„°ë¥¼ ì±„ì›Œì¤ë‹ˆë‹¤!

            // 3. ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
            renderClientList();

        } catch (e) {
            console.error("ë¡œë”© ì‹¤íŒ¨:", e);
            if(listContainer) listContainer.innerHTML = '<div style="color:red; text-align:center; padding:20px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>';
        }
    }
      
    
// [ê±°ë˜ì²˜ ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ - ì•ˆì „ì¥ì¹˜ ì¶”ê°€ ë²„ì „]
    function renderClientList() {
        const container = document.getElementById('client-management-list');
        if (!container) return; // HTMLì— íƒœê·¸ê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨

        container.innerHTML = "";

        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ (ë°ì´í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì¤‘ë‹¨)
        if (!globalTitanData || typeof globalTitanData !== 'object') {
            container.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>";
            return;
        }

        const clientNames = Object.keys(globalTitanData);

        if (clientNames.length === 0) {
            container.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>ë“±ë¡ëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
            return;
        }

        // ğŸŸ¢ [ìˆ˜ì •ë¨] ì •ë ¬ ë¡œì§ì— ì•ˆì „ì¥ì¹˜ ì¶”ê°€ (ì—ëŸ¬ ì›ì¸ í•´ê²°)
        clientNames.sort((a, b) => {
            // ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸. ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ ì·¨ê¸‰
            const listA = Array.isArray(globalTitanData[a]) ? globalTitanData[a] : [];
            const listB = Array.isArray(globalTitanData[b]) ? globalTitanData[b] : [];

            // ì§„í–‰ì¤‘ì¸ í˜„ì¥ ê°œìˆ˜ ì„¸ê¸°
            const countA = listA.filter(s => s.status !== 'ì™„ë£Œ').length;
            const countB = listB.filter(s => s.status !== 'ì™„ë£Œ').length;

            if (countB !== countA) return countB - countA; // ê°œìˆ˜ ë§ì€ ìˆœ
            return a.localeCompare(b); // ì´ë¦„ ìˆœ
        });

        // ... (ì´í•˜ ìŠ¤ì™€ì´í¼ ìƒì„± ì½”ë“œëŠ” ë™ì¼í•˜ì§€ë§Œ, ì•ˆì „ì„ ìœ„í•´ ì „ì²´ ì œê³µ) ...
        let html = `<div class="swiper client-management-swiper" style="width:100%; padding-bottom:30px;"><div class="swiper-wrapper">`;

        clientNames.forEach(client => {
            // ì—¬ê¸°ë„ ì•ˆì „ì¥ì¹˜: ë°°ì—´ì´ ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ
            const sites = Array.isArray(globalTitanData[client]) ? globalTitanData[client] : [];

            // í˜„ì¥ ì •ë ¬ (ì™„ë£Œëœ ê±´ ë’¤ë¡œ)
            sites.sort((x, y) => (x.status === 'ì™„ë£Œ') === (y.status === 'ì™„ë£Œ') ? 0 : x.status === 'ì™„ë£Œ' ? 1 : -1);

            html += `
            <div class="swiper-slide" style="width:90%; margin:0 auto;">
                <div class="client-card">
                    <div class="client-header">
                        ğŸ¢ ${client} 
                        <span style="font-size:0.8rem; background:rgba(255,255,255,0.2); padding:2px 8px; border-radius:10px; margin-left:auto;">
                            ì´ ${sites.length}ê°œ
                        </span>
                    </div>
                    <div style="background:#f8fafc;">
            `;

            if (sites.length === 0) {
                html += `<div style="padding:20px; text-align:center; color:#94a3b8;">í˜„ì¥ ì •ë³´ ì—†ìŒ</div>`;
            } else {
                sites.forEach(s => {
                    const isFinished = s.status === 'ì™„ë£Œ';
                    html += `
                    <div class="site-row" style="${isFinished ? 'background:#f1f5f9; color:#94a3b8;' : 'background:white;'}">
                        <div>
                            <div style="font-weight:bold; font-size:1rem; ${isFinished ? 'text-decoration:line-through;' : 'color:#1e293b;'}">
                                ${s.name}
                            </div>
                             <div style="font-size:0.8rem; margin-top:2px;">
                                ${s.addr ? `ğŸ“ ${s.addr}` : ''}
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <span onclick="toggleSiteStatus('${client}', '${s.name}', '${s.status}')" 
                                  style="padding:4px 8px; border-radius:6px; font-size:0.75rem; cursor:pointer; font-weight:bold; 
                                  ${isFinished ? 'background:#cbd5e1; color:white;' : 'background:#dbeafe; color:#2563eb;'}">
                                ${isFinished ? 'ì™„ë£Œë¨' : 'ì§„í–‰ì¤‘'}
                            </span>
                            <div style="margin-top:6px;">
                                <button onclick="deleteSite('${client}', '${s.name}')" style="background:none; border:none; color:#ef4444; font-size:0.8rem; cursor:pointer;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>`;
                });
            }
            html += `</div></div></div>`;
        });

        html += `</div><div class="swiper-pagination"></div></div>`;
        container.innerHTML = html;

        if(window.clientSwiper) window.clientSwiper.destroy();
        window.clientSwiper = new Swiper('.client-management-swiper', {
            slidesPerView: 'auto',
            spaceBetween: 15,
            centeredSlides: true,
            observer: true,
            observeParents: true,
            pagination: { el: '.swiper-pagination', clickable: true }
        });
    }


      // 1. ê´€ë¦¬ ê°€ëŠ¥í•œ ë¦¬ìŠ¤íŠ¸ (letìœ¼ë¡œ ì„ ì–¸í•˜ì—¬ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ í•¨)
    let vehicleList = ["ë´‰ê³ ", "í¬í„°", "ìŠ¤íƒ€ë ‰ìŠ¤", "M4"];
    let workList = ["ë°°ê´€", "ì…ì„ ", "ë‹¨ë§", "íŠ¸ë ˆì´", "ì² ê±°", "ì²­ì†Œ", "ìì¬ì •ë¦¬"];

    // 2. ì‚­ì œ ëª¨ë“œ ìƒíƒœ ê´€ë¦¬
    let deleteMode = { car: false, work: false };

    // ------------------------------------------
    // [ì°¨ëŸ‰ & ê³µì • ê³µí†µ ë¡œì§]
    // ------------------------------------------

    // ì¹© ë Œë”ë§ (ì°¨ëŸ‰)
    function renderVehicleChips(currentVal) {
        const box = document.getElementById('car-chips-area');
        const input = document.getElementById('sched-car');
        
        // í˜„ì¬ ì„ íƒëœ ê°’ë“¤
        const selected = currentVal ? currentVal.split(',').map(s=>s.trim()) : [];
        
        box.innerHTML = vehicleList.map(item => {
            const isActive = selected.includes(item);
            // ì‚­ì œ ëª¨ë“œë©´ 'delete-mode' í´ë˜ìŠ¤, ì•„ë‹ˆë©´ ì„ íƒ ì—¬ë¶€ì— ë”°ë¼ 'active'
            const modeClass = deleteMode.car ? 'delete-mode' : (isActive ? 'active' : '');
            const clickAction = deleteMode.car ? `removePreset('car', '${item}')` : `toggleSelection('car', '${item}')`;
            
            return `<div class="chip ${modeClass}" onclick="${clickAction}">
                        ${item} ${deleteMode.car ? 'âŒ' : ''}
                    </div>`;
        }).join('');
        
        input.value = selected.join(', ');
    }

    // ì¹© ë Œë”ë§ (ì‘ì—…ë‚´ìš©)
    function renderWorkPresets(currentVal) {
        const box = document.getElementById('work-preset-list');
        const input = document.getElementById('sched-content');
        
        const selected = currentVal ? currentVal.split(',').map(s=>s.trim()) : [];

        box.innerHTML = workList.map(item => {
            const isActive = selected.includes(item);
            const modeClass = deleteMode.work ? 'delete-mode' : (isActive ? 'active' : '');
            const clickAction = deleteMode.work ? `removePreset('work', '${item}')` : `toggleSelection('work', '${item}')`;

            return `<div class="chip ${modeClass}" onclick="${clickAction}">
                        ${item} ${deleteMode.work ? 'âŒ' : ''}
                    </div>`;
        }).join('');

        input.value = selected.join(', ');
    }

  // [4] í•­ëª© ì¶”ê°€/ì‚­ì œ/ëª¨ë“œë³€ê²½ í•¨ìˆ˜
    function addPreset(type) {
        const input = document.getElementById(type === 'car' ? 'new-car-input' : 'new-work-input');
        const val = input.value.trim();
        const list = type === 'car' ? vehicleList : workList;
        if (val && !list.includes(val)) {
            list.push(val); input.value = "";
            if(type === 'car') renderVehicleChips(document.getElementById('sched-car').value);
            else renderWorkPresets(document.getElementById('sched-content').value);
        }
    }
    function removePreset(type, item) {
        if (!confirm(`'${item}' í•­ëª©ì„ ì˜êµ¬ ì‚­ì œí• ê¹Œìš”?`)) return;
        if (type === 'car') {
            vehicleList = vehicleList.filter(i => i !== item);
            renderVehicleChips(document.getElementById('sched-car').value.split(',').filter(i => i !== item).join(', '));
        } else {
            workList = workList.filter(i => i !== item);
            renderWorkPresets(document.getElementById('sched-content').value.split(',').filter(i => i !== item).join(', '));
        }
    }
    function toggleDeleteMode(type) {
        deleteMode[type] = !deleteMode[type];
        if(type === 'car') renderVehicleChips(document.getElementById('sched-car').value);
        else renderWorkPresets(document.getElementById('sched-content').value);
    }
    function toggleSelection(type, item) {
        const inputId = type === 'car' ? 'sched-car' : 'sched-content';
        const input = document.getElementById(inputId);
        let selected = input.value ? input.value.split(',').map(s=>s.trim()) : [];
        if (selected.includes(item)) selected = selected.filter(i => i !== item);
        else selected.push(item);
        if(type === 'car') renderVehicleChips(selected.join(', '));
        else renderWorkPresets(selected.join(', '));
    }
      

      

    function addWorker() { const d = { name: document.getElementById('new-name').value, role: document.getElementById('new-role').value, rate: document.getElementById('new-rate').value, pw: document.getElementById('new-pw').value, phone: document.getElementById('new-phone').value, address: document.getElementById('new-address').value }; sendToGas('adminAddWorker', d); }
    function saveClient() { const d = { client: document.getElementById('c_client').value, site: document.getElementById('c_site').value, address: document.getElementById('c_addr').value }; sendToGas('adminAddClient', d); }
    function selectClientChip(el, name) { document.getElementById('c_client').value = name; }
    function saveMaterial() { const d = { cat: document.getElementById('m_cat').value, name: document.getElementById('m_name').value, spec: document.getElementById('m_spec').value, unit: document.getElementById('m_unit').value, price: document.getElementById('m_price').value }; sendToGas('adminAddMaterial', d); }
    async function toggleSiteStatus(c, s, st) { if (confirm("ìƒíƒœë³€ê²½?")) await sendToGas('updateSiteStatus', { client: c, site: s, status: st==='ì™„ë£Œ'?'ì§„í–‰ì¤‘':'ì™„ë£Œ' }); }
    async function editAddress(c, s, a) { const n = prompt("ì£¼ì†Œ:", a); if (n) await sendToGas('updateSiteAddress', { client: c, site: s, address: n }); }
    async function changePassword(n) { const p = prompt("ìƒˆ ë¹„ë²ˆ:"); if (p) await sendToGas('adminUpdatePassword', { userName: n, newPw: p }); }
    async function updateStatus(n, s) { if (confirm("ìƒíƒœë³€ê²½?")) await sendToGas('adminUpdateStatus', { userName: n, status: s }); }
    function copyText(t) { navigator.clipboard.writeText(t); alert("ë³µì‚¬ë¨"); }
    </script>
</body>
</html>
