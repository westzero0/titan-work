<!DOCTYPE html>
<html lang="ko">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>íƒ€ì´íƒ„ ê´€ë¦¬ì íŒ¨ë„</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary-color: #2563eb; --bg-color: #f8f9fa; }
    body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-color); margin: 0; padding: 0; overflow: hidden; }

      button:active {
    opacity: 0.8;
    transform: scale(0.98);
}
      
    /* í—¤ë” */
    .header { background: #fff; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #ddd; position: fixed; top:0; width: 100%; z-index: 100; }

    /* ë©”ì¸ ìŠ¤ì™€ì´í”„ ì˜ì—­ */
    .swiper { width: 100%; height: calc(100vh - 120px); margin-top: 55px; }
    .swiper-slide { overflow-y: auto; padding: 20px; box-sizing: border-box; padding-bottom: 80px; }

    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
    h3 { margin-top: 0; color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 10px; }

    /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
    label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; color: #444; }
    input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
    button { width: 100%; padding: 15px; margin-top: 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; }

    /* í•˜ë‹¨ ê³ ì • íƒ­ ë°” */
    .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: #fff; display: flex; border-top: 1px solid #ddd; z-index: 100; }
    .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; font-size: 11px; cursor: pointer; }
    .nav-item.active { color: var(--primary-color); }
    .nav-item i { font-size: 20px; margin-bottom: 4px; }


/* ê±°ë˜ì²˜ë³„ ê·¸ë£¹ ì¹´ë“œ */
.client-group-card {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    margin-bottom: 20px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

/* ê±°ë˜ì²˜ ì´ë¦„ í—¤ë” */
.group-header {
    background: #f8fafc;
    padding: 12px 15px;
    font-weight: bold;
    font-size: 1rem;
    border-bottom: 1px solid #e2e8f0;
    color: #1e293b;
}

/* í˜„ì¥ë³„ í•œ ì¤„ ë¡œì§ (ì´ê²Œ ì¤‘ìš”!) */
.site-row {
    display: flex;             /* ê°€ë¡œë¡œ ë°°ì¹˜ */
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #f1f5f9;
    width: 100%;               /* ì „ì²´ í­ ì‚¬ìš© */
    box-sizing: border-box;    /* íŒ¨ë”© í¬í•¨ í­ ê³„ì‚° */
}

.site-main {
    flex: 1;                   /* ê¸€ì ì˜ì—­ì´ ìµœëŒ€í•œ ë„“ê²Œ ì°¨ì§€ */
    min-width: 0;              /* ê¸€ì ë„˜ì¹¨ ë°©ì§€ */
    margin-right: 10px;
}

.site-name {
    font-size: 0.95rem;
    font-weight: 500;
    white-space: nowrap;       /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
    overflow: hidden;
    text-overflow: ellipsis;   /* ë„ˆë¬´ ê¸¸ë©´ ... ì²˜ë¦¬ */
}

.site-addr {
    font-size: 0.8rem;
    color: #64748b;
    margin-top: 4px;
    cursor: pointer;
}

/* ì™„ë£Œëœ í˜„ì¥ íë¦¬ê²Œ */
.status-done {
    background: #f1f5f9;
    opacity: 0.6;
}

/* ìƒíƒœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.status-toggle-btn {
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.75rem;
    border: none;
    cursor: pointer;
    min-width: 60px;          /* ë²„íŠ¼ í­ ê³ ì • */
}
.is-ing { background: #dcfce7; color: #166534; }
.is-completed { background: #cbd5e1; color: #475569; }

    
    /* ì¹© ìŠ¤íƒ€ì¼ */
.chip {
    padding: 6px 12px;
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: 0.2s;
}
.chip.active {
    background: #2563eb;
    color: #fff;
    border-color: #2563eb;
}

/* í˜„ì¥ ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.site-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid #eee;
}
.site-item.status-done {
    opacity: 0.4; /* 2-2. ì™„ë£Œëœ ê±´ íë¦¬ê²Œ */
    background: #f9f9f9;
}
.site-info { flex: 1; }
.site-name { font-weight: bold; font-size: 0.95rem; }
.site-addr { font-size: 0.8rem; color: #666; text-decoration: underline; cursor: pointer; }

/* ìƒíƒœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.status-toggle {
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    border: none;
}
.status-ing { background: #dcfce7; color: #166534; } /* ì§„í–‰ì¤‘ (ì´ˆë¡ê³„ì—´) */
.status-completed { background: #e2e8f0; color: #475569; } /* ì™„ë£Œ (íšŒìƒ‰ê³„ì—´) */

    
    /* ì§ì› ê´€ë¦¬ ì¹´ë“œ ì „ì²´ ì»¨í…Œì´ë„ˆ */
#worker-list-admin {
    display: flex;
    flex-direction: column;
    gap: 15px; /* ì¹´ë“œ ì‚¬ì´ ê°„ê²© */
    padding-bottom: 20px;
}

/* ê°œë³„ ì§ì› ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.worker-card {
    background: #fff;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    border-top: 4px solid #ddd; /* ê¸°ë³¸ ìƒíƒœ ë°” */
    position: relative;
    display: block; /* ê°€ë¡œ ê½‰ ì°¨ê²Œ */
}

/* ì¬ì§/í‡´ì‚¬ ìƒíƒœë³„ ìƒë‹¨ ë°” ìƒ‰ìƒ */
.worker-card[style*="#2563eb"] { border-top-color: #2563eb !important; }
.worker-card[style*="#ef4444"] { border-top-color: #ef4444 !important; }

/* ì¹´ë“œ ìƒë‹¨ ì´ë¦„ ë° ìƒíƒœ */
.worker-card .name {
    font-size: 1.1rem;
    font-weight: bold;
    color: #333;
}

/* ìƒíƒœ ë°°ì§€ */
.status-badge {
    font-size: 0.75rem;
    padding: 3px 8px;
    border-radius: 20px;
    color: #fff;
    font-weight: bold;
}
.status-on { background: #2563eb; }
.status-off { background: #ef4444; }

/* ì •ë³´ í…ìŠ¤íŠ¸ ì˜ì—­ */
.info {
    margin-top: 10px;
    font-size: 0.9rem;
    line-height: 1.6;
    color: #555;
}

.copy-hint { font-size: 0.75rem; color: #999; margin-bottom: 2px; }
.copyable { 
    color: #2563eb; 
    text-decoration: underline; 
    cursor: pointer; 
    word-break: break-all; /* ì£¼ì†Œ ê¸¸ ë•Œ ì¤„ë°”ê¿ˆ */
}

/* ì¹´ë“œ í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
.card-btns {
    margin-top: 15px;
    display: flex;
    gap: 8px;
}

.btn-sm {
    flex: 1;
    padding: 8px !important;
    font-size: 0.85rem !important;
    margin-top: 0 !important; /* ê¸°ì¡´ ë²„íŠ¼ margin ì œê±° */
}

.btn-outline {
    background: #fff !important;
    color: #666 !important;
    border: 1px solid #ddd !important;
}

.btn-red {
    background: #fee2e2 !important;
    color: #ef4444 !important;
}


    
  </style>
  
</head>


    
<body>
  <div class="header">âš¡ íƒ€ì´íƒ„ í†µí•© ê´€ë¦¬ì</div>


    <div class="swiper">
  <div class="swiper-wrapper">
    <div class="swiper-slide">

        
    <div class="card">
    <h3>ğŸ‘¤ ì‹ ê·œ ì¸ì› ë“±ë¡</h3>
    <input type="text" id="new-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)">
    <select id="new-role">
        <option value="ê¸°ê³µ">ê¸°ê³µ</option>
        <option value="ì¡°ê³µ">ì¡°ê³µ</option>
    </select>
    <input type="number" id="new-rate" placeholder="ì¼ë‹¹ (ìˆ«ìë§Œ)">
    <input type="text" id="new-phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ (ì˜ˆ: 010-1234-5678)">
    <input type="text" id="new-address" placeholder="ì§‘ì£¼ì†Œ">
    <input type="password" id="new-pw" placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)" maxlength="4">
    <button class="btn-blue" onclick="addWorker()">ë“±ë¡í•˜ê¸°</button>
</div>
   

    <div class="card">
        <h3>ğŸ‘¥ ì§ì› ê´€ë¦¬</h3>
        <div id="worker-list-admin">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
     </div>

      <div class="swiper-slide">
     <div class="card">
    <h3>ğŸ¢ ê±°ë˜ì²˜ ë° í˜„ì¥ ë“±ë¡</h3>
    
    <div class="copy-hint" style="margin-bottom:8px;">ê¸°ì¡´ ê±°ë˜ì²˜ ì„ íƒ (ë˜ëŠ” ì§ì ‘ ì…ë ¥)</div>
    <div id="client-chips" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px;">
        </div>
    
    <div class="input-group">
        <label>ê±°ë˜ì²˜ëª…</label>
        <input type="text" id="c_client" placeholder="ì¹©ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    
    <div class="input-group">
        <label>í˜„ì¥ëª…</label>
        <input type="text" id="c_site" placeholder="í˜„ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    
    <div class="input-group">
        <label>í˜„ì¥ ì£¼ì†Œ</label>
        <input type="text" id="c_addr" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (Dì—´ ì €ì¥)">
    </div>
    
    <button class="btn-blue" onclick="saveClient()" style="width:100%">í˜„ì¥ ë“±ë¡í•˜ê¸°</button>
</div>

<div class="card" style="margin-top:20px;">
    <h3>ğŸ“‹ í˜„ì¥ í˜„í™© ê´€ë¦¬</h3>
    <div id="client-management-list">
        </div>
</div>
    </div>

    <div class="swiper-slide">
      <div class="card">
        <h3>ğŸ“¦ ìì¬ ë§ˆìŠ¤í„° ë“±ë¡</h3>
        <label>ëŒ€ë¶„ë¥˜</label><input type="text" id="m_cat">
        <label>í’ˆëª©</label><input type="text" id="m_name">
        <label>ê·œê²©</label><input type="text" id="m_spec">
        <label>ë‹¨ìœ„</label><input type="text" id="m_unit">
        <label>ë‹¨ê°€</label><input type="number" id="m_price">
        <button onclick="saveMaterial()">ìì¬ í’ˆëª© ë“±ë¡</button>
      </div>
    </div>

    <div class="swiper-slide">
      <div class="card">
        <h3>ğŸ“… ì‘ì—… ì¼ì • ë“±ë¡</h3>
        <label>ë‚ ì§œ</label><input type="date" id="s_date">
        <label>ê±°ë˜ì²˜</label><input type="text" id="s_client">
        <label>í˜„ì¥ëª…</label><input type="text" id="s_site">
        <button onclick="saveSchedule()">ì¼ì • ë“±ë¡</button>
      </div>
    </div>
  </div>
</div>

<div class="bottom-nav">
  <div class="nav-item active" onclick="jumpTo(0)">ğŸ‘¥ <span>ì¸ì›</span></div>
  <div class="nav-item" onclick="jumpTo(1)">ğŸ¢ <span>ê±°ë˜ì²˜</span></div>
  <div class="nav-item" onclick="jumpTo(2)">ğŸ“¦ <span>ìì¬</span></div>
  <div class="nav-item" onclick="jumpTo(3)">ğŸ“… <span>ì¼ì •</span></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    
      
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw_zKyCAuCOpdr2oHD0wxL9iAJ_d5ALkP4zA6G7B0rnaAXAF4wE4_mSZ_4bY7j0PUMp/exec"; // ğŸ‘ˆ ê¼­ ë³¸ì¸ ì£¼ì†Œë¡œ ìˆ˜ì •í•˜ì„¸ìš”!

let swiper = null; // ì´ˆê¸°ê°’ì„ nullë¡œ ì„¤ì •

    // ìŠ¤ì™€ì´í¼ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë³„ë„ë¡œ ë§Œë“­ë‹ˆë‹¤.
    function initSwiper() {
        const swiperContainer = document.querySelector('.swiper');
        if (!swiperContainer) return;

        swiper = new Swiper('.swiper', {
            speed: 400,
            loop: false,
            allowTouchMove: true, // ì†ê°€ë½ ìŠ¤ì™€ì´í”„ í—ˆìš©
            on: {
                slideChange: function () {
                    updateNav(this.activeIndex);
                }
            }
        });
        console.log("ìŠ¤ì™€ì´í¼ ì¤€ë¹„ ì™„ë£Œ");
    }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ (ì •ë¦¬ëœ ë²„ì „)
    window.addEventListener('DOMContentLoaded', () => {
        // 1. ìŠ¤ì™€ì´í¼ ì‹¤í–‰
        initSwiper();
        
        // 2. ë‚ ì§œ ì„¤ì •
        const sDateInput = document.getElementById('s_date');
        if (sDateInput) sDateInput.valueAsDate = new Date();
        
        // 3. ì§ì› ë°ì´í„° ë¡œë“œ
        if (typeof loadAdminData === 'function') {
            loadAdminData();
        }
        
        // 4. ê±°ë˜ì²˜ ê´€ë¦¬ ë°ì´í„° ë¡œë“œ (í•¨ìˆ˜ ì•ˆìœ¼ë¡œ ì•ˆì „í•˜ê²Œ í¬í•¨)
        if (typeof loadClientManagement === 'function') {
            loadClientManagement();
        }
    }); // <--- ì—¬ê¸°ì„œ í•œ ë²ˆë§Œ ë‹«ìœ¼ë©´ ë©ë‹ˆë‹¤.
      

    // íƒ­ í´ë¦­ ì‹œ ì´ë™ (ì¤€ë¹„ ì•ˆëìœ¼ë©´ ë‹¤ì‹œ í•œë²ˆ ì´ˆê¸°í™” ì‹œë„)
    function jumpTo(index) {
        if (!swiper) {
            console.log("ìŠ¤ì™€ì´í¼ ì¬ì—°ê²° ì‹œë„ ì¤‘...");
            initSwiper();
        }
        
        if (swiper) {
            swiper.slideTo(index);
        } else {
            alert("í™”ë©´ ì´ˆê¸°í™” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
        }
    }

    function updateNav(index) {
        document.querySelectorAll('.nav-item').forEach((item, i) => {
            if (i === index) item.classList.add('active');
            else item.classList.remove('active');
        });
    }

    // 5. [í•µì‹¬ ìˆ˜ì •] ì„œë²„ ì „ì†¡ ê³µí†µ í•¨ìˆ˜ (async ìœ„ì¹˜ í™•ì¸)
    async function sendToGas(action, data) {
        try {
            const res = await fetch(GAS_URL, {
                method: 'POST',
                body: JSON.stringify({ action: action, data: data }),
                redirect: 'follow'
            });
            const text = await res.text();
            if (text.includes("SUCCESS")) {
                alert("âœ… ë“±ë¡ ì™„ë£Œ!");
                location.reload();
            } else {
                alert("âš ï¸ ê²°ê³¼: " + text);
            }
        } catch (e) {
            alert("ğŸš¨ í†µì‹  ì—ëŸ¬: " + e.message);
        }
    }

 // ê±°ë˜ì²˜ ë“±ë¡ ë²„íŠ¼ìš©
function saveClient() {
    const data = {
        client: document.getElementById('c_client').value,
        site: document.getElementById('c_site').value,
        address: document.getElementById('c_addr').value
    };
    if(!data.client || !data.site) return alert("ê±°ë˜ì²˜ì™€ í˜„ì¥ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    sendToGas('adminAddClient', data);
}

// ìì¬ ë“±ë¡ ë²„íŠ¼ìš©
function saveMaterial() {
    const data = {
        cat: document.getElementById('m_cat').value,
        name: document.getElementById('m_name').value,
        spec: document.getElementById('m_spec').value,
        unit: document.getElementById('m_unit').value,
        price: document.getElementById('m_price').value
    };
    if(!data.name) return alert("í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    sendToGas('adminAddMaterial', data);
}

// ì¼ì • ë“±ë¡ ë²„íŠ¼ìš©
function saveSchedule() {
    const data = {
        date: document.getElementById('s_date').value,
        client: document.getElementById('s_client').value,
        site: document.getElementById('s_site').value
    };
    if(!data.client || !data.site) return alert("ë‚ ì§œì™€ í˜„ì¥ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    sendToGas('saveSchedule', data);
}

        
        
   // 1. ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸° (async í‚¤ì›Œë“œê°€ í•µì‹¬!)
async function loadAdminData() {
    const box = document.getElementById('worker-list-admin');
    box.innerHTML = "â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'getAllWorkerInfo' }),
            redirect: 'follow' 
        });
        
        // ğŸ’¡ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ë°›ê³  JSONìœ¼ë¡œ ë³€í™˜ (CORS ì•ˆì •ì„± í™•ë³´)
        const text = await res.text();
        const workers = JSON.parse(text);
        
   box.innerHTML = workers.map(w => `
    <div class="worker-card" style="border-top-color: ${w.status === 'ì¬ì§' ? '#2563eb' : '#ef4444'}">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="name">${w.name} <span style="font-size:0.8rem; font-weight:normal;">(${w.role})</span></div>
            <span class="status-badge ${w.status === 'ì¬ì§' ? 'status-on' : 'status-off'}">${w.status}</span>
        </div>
        
        <div class="info">
            <div class="copy-hint">ğŸ“± íœ´ëŒ€í°</div>
            <div class="copyable" onclick="copyText('${w.phone}')">${w.phone || 'ë²ˆí˜¸ ì—†ìŒ'}</div>
            
            <div class="copy-hint" style="margin-top:8px;">ğŸ  ì§‘ì£¼ì†Œ</div>
            <div class="copyable" onclick="copyText('${w.address}')">${w.address || 'ì£¼ì†Œ ì—†ìŒ'}</div>
            
            <div style="margin-top:10px; display:flex; justify-content:space-between;">
                <span>ğŸ’° ë‹¨ê°€: <b>${Number(w.rate).toLocaleString()}</b></span>
                <span style="background:#eee; padding:2px 5px; border-radius:4px;">ğŸ”‘ PW: ${w.pw}</span>
            </div>
        </div>

        <div class="card-btns">
            <button class="btn-sm btn-outline" onclick="changePassword('${w.name}')">ë¹„ë²ˆë³€ê²½</button>
            <button class="btn-sm btn-red" onclick="updateStatus('${w.name}', '${w.status === 'ì¬ì§' ? 'í‡´ì‚¬' : 'ì¬ì§'}')">
                ${w.status === 'ì¬ì§' ? 'í‡´ì§ì²˜ë¦¬' : 'ë³µêµ¬í•˜ê¸°'}
            </button>
        </div>
    </div>
`).join('');
    } catch (e) {
        console.error(e);
        box.innerHTML = `<p style="color:red">âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (CORS ë˜ëŠ” ë¬¸ë²• ì—ëŸ¬)</p>`;
    }
}
          

     // 2. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í•¨ìˆ˜
        async function changePassword(name) {
            const newPw = prompt(`${name}ë‹˜ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.`);
            if (!newPw || newPw.length !== 4 || isNaN(newPw)) return alert("ìˆ«ì 4ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.");

            if (confirm(`${name}ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ [${newPw}]ë¡œ ë³€ê²½í• ê¹Œìš”?`)) {
                try {
                    await fetch(GAS_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ action: 'adminUpdatePassword', userName: name, newPw: newPw }),
                        redirect: 'follow'
                    });
                    alert("âœ… ë³€ê²½ ì™„ë£Œ!");
                    loadAdminData();
                } catch (e) { alert("ë¹„ë²ˆ ë³€ê²½ ì‹¤íŒ¨"); }
            }
        }

        
      // 3. ì‹ ê·œ ì¸ì› ë“±ë¡ í•¨ìˆ˜
      async function addWorker() {
    const data = {
        name: document.getElementById('new-name').value,
        role: document.getElementById('new-role').value,
        rate: document.getElementById('new-rate').value,
        phone: document.getElementById('new-phone').value, // ì¶”ê°€
        address: document.getElementById('new-address').value, // ì¶”ê°€
        pw: document.getElementById('new-pw').value
    };

    if(!data.name || !data.pw) return alert("ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    
    try {
        await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'adminAddWorker', data }),
            redirect: 'follow' 
        });
        alert("âœ… ë“±ë¡ ì™„ë£Œ!");
        location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ëª©ë¡ ê°±ì‹ 
    } catch (e) { 
        alert("ë“±ë¡ ì‹¤íŒ¨: " + e.toString()); 
    }
}
        

    // 4. ìƒíƒœ ë³€ê²½ í•¨ìˆ˜ (í‡´ì‚¬/ì¬ì§)
        async function updateStatus(name, newStatus) {
            if(!confirm(`${name}ë‹˜ì„ ${newStatus} ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            try {
                await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: 'adminUpdateStatus', userName: name, status: newStatus }),
                    redirect: 'follow'
                });
                loadAdminData();
            } catch (e) { alert("ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨"); }
        }

        window.onload = loadAdminData;

        function copyText(text) {
    if (!text) return;
    navigator.clipboard.writeText(text).then(() => {
        alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: " + text);
    });
}

      // 1. ê±°ë˜ì²˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì¹© ìƒì„± ë° ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
async function loadClientManagement() {
    const listBox = document.getElementById('client-management-list');
    const chipBox = document.getElementById('client-chips');
    
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'getClientListData' }) 
        });
        const data = await res.json(); 

        // 1. ê±°ë˜ì²˜ëª… ì¹© ìƒì„± (ì¤‘ë³µ ì œê±°)
        const uniqueClients = [...new Set(data.map(item => item.client))];
        chipBox.innerHTML = uniqueClients.map(client => 
            `<div class="chip" onclick="selectClientChip(this, '${client}')">${client}</div>`
        ).join('');

        // 2. ë°ì´í„°ë¥¼ ê±°ë˜ì²˜ë³„ë¡œ ê·¸ë£¹í™”
        const grouped = data.reduce((acc, curr) => {
            if (!acc[curr.client]) acc[curr.client] = [];
            acc[curr.client].push(curr);
            return acc;
        }, {});

        // 3. ê·¸ë£¹ë³„ë¡œ ì¹´ë“œ ìƒì„±
        let html = '';
        for (const client in grouped) {
            html += `
                <div class="client-group-card">
                    <div class="group-header">ğŸ¢ ${client}</div>
                    <div class="group-body">
                        ${grouped[client].map(item => `
                            <div class="site-row ${item.status === 'ì™„ë£Œ' ? 'status-done' : ''}">
                                <div class="site-main">
                                    <div class="site-name">${item.site}</div>
                                    <div class="site-addr" onclick="editAddress('${item.client}', '${item.site}', '${item.address || ''}')">
                                        ğŸ“ ${item.address || 'ì£¼ì†Œ ì…ë ¥'}
                                    </div>
                                </div>
                                <button class="status-toggle-btn ${item.status === 'ì™„ë£Œ' ? 'is-completed' : 'is-ing'}" 
                                        onclick="toggleSiteStatus('${item.client}', '${item.site}', '${item.status}')">
                                    ${item.status || 'ì§„í–‰ì¤‘'}
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        listBox.innerHTML = html;
    } catch (e) { listBox.innerHTML = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"; }
}

// ì¹© ì„ íƒ í•¨ìˆ˜
function selectClientChip(el, name) {
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('c_client').value = name; // 1. ê±°ë˜ì²˜ëª… ìë™ ì…ë ¥
}

// 2-2. í˜„ì¥ ìƒíƒœ ë³€ê²½ (ì§„í–‰ì¤‘ <-> ì™„ë£Œ)
async function toggleSiteStatus(client, site, currentStatus) {
    const newStatus = currentStatus === 'ì™„ë£Œ' ? 'ì§„í–‰ì¤‘' : 'ì™„ë£Œ';
    if(!confirm(`[${site}] í˜„ì¥ì„ ${newStatus} ìƒíƒœë¡œ ë³€ê²½í• ê¹Œìš”?`)) return;
    
    await sendToGas('updateSiteStatus', { client, site, status: newStatus });
    loadClientManagement(); // ìƒˆë¡œê³ ì¹¨
}

// 2-3. ì£¼ì†Œ ìˆ˜ì • ê¸°ëŠ¥
async function editAddress(client, site, oldAddr) {
    const newAddr = prompt(`[${site}]ì˜ ìƒˆ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”:`, oldAddr);
    if (newAddr === null || newAddr === oldAddr) return;
    
    await sendToGas('updateSiteAddress', { client, site, address: newAddr });
    loadClientManagement();
}
      

      

        
    </script>
</body>
</html>
