<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ì´íƒ„ ê´€ë¦¬ì íŒ¨ë„</title>
    <style>
               body { font-family: sans-serif; padding: 20px; background: #f1f5f9; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
    input, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
    button { width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .btn-blue { background: #2563eb; color: white; }
    .btn-red { background: #ef4444; color: white; margin-top: 5px; }

    /* ğŸ’¡ ë¹„ë²ˆë³€ê²½ ë²„íŠ¼ê³¼ ë ˆì´ì•„ì›ƒì„ ìœ„í•œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
    .btn-outline { background: white; color: #64748b; border: 1px solid #cbd5e1; font-size: 0.8rem; padding: 6px; margin-bottom: 4px; border-radius: 4px; }
    .btn-outline:hover { background: #f8f9fa; }
    .btn-group { display: flex; flex-direction: column; width: 90px; }
    
    /* ğŸ’¡ ì¹´ë“œë·° ì „ìš© ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
#worker-list-admin {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* í™”ë©´ í¬ê¸°ì— ë§ê²Œ ìë™ ë°°ì¹˜ */
    gap: 15px;
    margin-top: 20px;
}

        
.worker-card {
    background: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    border-top: 5px solid #2563eb; /* ìƒë‹¨ì— íŒŒë€ìƒ‰ í¬ì¸íŠ¸ */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.2s;
}

.worker-card:hover { transform: translateY(-5px); } /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì‚´ì§ ë“¤ë¦¼ */

.worker-card .name { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
.worker-card .role { color: #64748b; font-size: 0.85rem; }
.worker-card .info { margin: 10px 0; font-size: 0.85rem; border-top: 1px solid #f1f5f9; padding-top: 10px; }

.worker-card .pw-box { background: #f8fafc; padding: 4px 8px; border-radius: 4px; color: #2563eb; font-weight: bold; }

.card-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
.btn-sm { padding: 8px 0 !important; font-size: 0.75rem !important; }



        /* ë³µì‚¬ ê°€ëŠ¥í•œ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
.copyable {
    cursor: pointer;
    color: #475569;
    padding: 2px 4px;
    border-radius: 4px;
    transition: background 0.2s;
    display: inline-block;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.copyable:hover { background: #e2e8f0; color: #2563eb; }
.copy-hint { font-size: 0.7rem; color: #94a3b8; margin-bottom: 2px; }

        
    .status-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; display: inline-block; margin: 4px 0; }
    .status-on { background: #dcfce7; color: #166534; }
    .status-off { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <h2>âš¡ ê´€ë¦¬ì ë§ˆìŠ¤í„° íŒ¨ë„</h2>

    <div class="card">
    <h3>ğŸ‘¤ ì‹ ê·œ ì¸ì› ë“±ë¡</h3>
    <input type="text" id="new-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)">
    <select id="new-role">
        <option value="ê¸°ê³µ">ê¸°ê³µ</option>
        <option value="ì¡°ê³µ">ì¡°ê³µ</option>
    </select>
    <input type="number" id="new-rate" placeholder="ì¼ë‹¹ (ìˆ«ìë§Œ)">
    <input type="text" id="new-phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ (ì˜ˆ: 010-1234-5678)">
    <input type="text" id="new-address" placeholder="ì§‘ì£¼ì†Œ">
    <input type="password" id="new-pw" placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)" maxlength="4">
    <button class="btn-blue" onclick="addWorker()">ë“±ë¡í•˜ê¸°</button>
</div>

    <div class="card">
        <h3>ğŸ‘¥ ì§ì› ê´€ë¦¬</h3>
        <div id="worker-list-admin">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwzPMdoF0FczYaxc14O0aUV3INoxn1lOIMRKcPirf6DUQDhFLTP-T99Nsd2SW3mxo8p/exec"; // ğŸ‘ˆ ê¼­ ë³¸ì¸ ì£¼ì†Œë¡œ ìˆ˜ì •í•˜ì„¸ìš”!

   // 1. ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸° (async í‚¤ì›Œë“œê°€ í•µì‹¬!)
async function loadAdminData() {
    const box = document.getElementById('worker-list-admin');
    box.innerHTML = "â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'getAllWorkerInfo' }),
            redirect: 'follow' 
        });
        
        // ğŸ’¡ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ë°›ê³  JSONìœ¼ë¡œ ë³€í™˜ (CORS ì•ˆì •ì„± í™•ë³´)
        const text = await res.text();
        const workers = JSON.parse(text);
        
     box.innerHTML = workers.map(w => `
    <div class="worker-card" style="border-top-color: ${w.status === 'ì¬ì§' ? '#2563eb' : '#ef4444'}">
        <div>
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <div class="name">${w.name} <span style="font-size:0.8rem; font-weight:normal;">(${w.role})</span></div>
                <span class="status-badge ${w.status === 'ì¬ì§' ? 'status-on' : 'status-off'}">${w.status}</span>
            </div>
        </div>
        
        <div class="info">
            <div class="copy-hint">ğŸ“± íœ´ëŒ€í° (í´ë¦­ ì‹œ ë³µì‚¬)</div>
            <div class="copyable" onclick="copyText('${w.phone}')">${w.phone || 'ë²ˆí˜¸ ì—†ìŒ'}</div>
            
            <div class="copy-hint" style="margin-top:8px;">ğŸ  ì§‘ì£¼ì†Œ (í´ë¦­ ì‹œ ë³µì‚¬)</div>
            <div class="copyable" onclick="copyText('${w.address}')" title="${w.address}">${w.address || 'ì£¼ì†Œ ì—†ìŒ'}</div>
            
            <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:0.8rem;">ë‹¨ê°€: <b>${Number(w.rate).toLocaleString()}</b></span>
                <span class="pw-box">PW: ${w.pw}</span>
            </div>
        </div>

        <div class="card-btns">
            <button class="btn-outline btn-sm" onclick="changePassword('${w.name}')">ë¹„ë²ˆë³€ê²½</button>
            <button class="btn-red btn-sm" onclick="updateStatus('${w.name}', '${w.status === 'ì¬ì§' ? 'í‡´ì‚¬' : 'ì¬ì§'}')">
                ${w.status === 'ì¬ì§' ? 'í‡´ì§' : 'ë³µêµ¬'}
            </button>
        </div>
    </div>
`).join('');
    } catch (e) {
        console.error(e);
        box.innerHTML = `<p style="color:red">âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (CORS ë˜ëŠ” ë¬¸ë²• ì—ëŸ¬)</p>`;
    }
}
          

     // 2. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í•¨ìˆ˜
        async function changePassword(name) {
            const newPw = prompt(`${name}ë‹˜ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.`);
            if (!newPw || newPw.length !== 4 || isNaN(newPw)) return alert("ìˆ«ì 4ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.");

            if (confirm(`${name}ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ [${newPw}]ë¡œ ë³€ê²½í• ê¹Œìš”?`)) {
                try {
                    await fetch(GAS_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ action: 'adminUpdatePassword', userName: name, newPw: newPw }),
                        redirect: 'follow'
                    });
                    alert("âœ… ë³€ê²½ ì™„ë£Œ!");
                    loadAdminData();
                } catch (e) { alert("ë¹„ë²ˆ ë³€ê²½ ì‹¤íŒ¨"); }
            }
        }

        
      // 3. ì‹ ê·œ ì¸ì› ë“±ë¡ í•¨ìˆ˜
      async function addWorker() {
    const data = {
        name: document.getElementById('new-name').value,
        role: document.getElementById('new-role').value,
        rate: document.getElementById('new-rate').value,
        phone: document.getElementById('new-phone').value, // ì¶”ê°€
        address: document.getElementById('new-address').value, // ì¶”ê°€
        pw: document.getElementById('new-pw').value
    };

    if(!data.name || !data.pw) return alert("ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    
    try {
        await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'adminAddWorker', data }),
            redirect: 'follow' 
        });
        alert("âœ… ë“±ë¡ ì™„ë£Œ!");
        location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ëª©ë¡ ê°±ì‹ 
    } catch (e) { 
        alert("ë“±ë¡ ì‹¤íŒ¨: " + e.toString()); 
    }
}
        

    // 4. ìƒíƒœ ë³€ê²½ í•¨ìˆ˜ (í‡´ì‚¬/ì¬ì§)
        async function updateStatus(name, newStatus) {
            if(!confirm(`${name}ë‹˜ì„ ${newStatus} ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            try {
                await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: 'adminUpdateStatus', userName: name, status: newStatus }),
                    redirect: 'follow'
                });
                loadAdminData();
            } catch (e) { alert("ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨"); }
        }

        window.onload = loadAdminData;

        function copyText(text) {
    if (!text) return;
    navigator.clipboard.writeText(text).then(() => {
        alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: " + text);
    });
}

        
    </script>
</body>
</html>
