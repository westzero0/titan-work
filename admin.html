<!DOCTYPE html>
<html lang="ko">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>íƒ€ì´íƒ„ ê´€ë¦¬ì íŒ¨ë„</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
  <style>
    :root { --primary-color: #2563eb; --bg-color: #f8f9fa; }
    body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-color); margin: 0; padding: 0; overflow: hidden; }

      button:active {
    opacity: 0.8;
    transform: scale(0.98);
}
      
   /* --- ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ê³µí†µ ìš”ì†Œ --- */
.header { background: #fff; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #ddd; position: fixed; top:0; width: 100%; z-index: 100; }

.swiper { 
    width: 100%; 
    height: calc(100vh - 130px); /* ğŸŸ¢ ë†’ì´ ê³„ì‚°ê°’ë„ ì‚´ì§ ì¡°ì • (ë‚´ë¹„ë°” ê³µê°„ í™•ë³´) */
    margin-top: 65px; /* ğŸŸ¢ ê¸°ì¡´ 50pxì—ì„œ 65pxë¡œ ì¦ê°€ */
}

.card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
h3 { margin-top: 0; color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 10px; }

label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; color: #444; }
input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
button { width: 100%; padding: 15px; margin-top: 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; }

/* 1. í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜: ê°•ë ¥ ê³ ì • ë° ê·¸ë˜í”½ ê°€ì† ì ìš© */
.bottom-nav {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 65px;
    background: #fff;
    display: flex;
    border-top: 1px solid #ddd;
    z-index: 2147483647 !important; /* ë¬´ì¡°ê±´ ë§¨ ìœ„ë¡œ */
    transform: translateZ(0);       /* ìŠ¤ì™€ì´í”„ ì‹œ ê¹œë¹¡ì„ ë°©ì§€ */
    -webkit-transform: translateZ(0);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    touch-action: none;
}

/* 2. ìŠ¬ë¼ì´ë“œ ì—¬ë°±: ë‚´ë¹„ê²Œì´ì…˜ì— ê°€ë ¤ì§€ì§€ ì•Šê²Œ í•˜ë‹¨ ì—¬ë°± í™•ë³´ */
.swiper-slide { 
    overflow-y: auto; 
    padding: 15px 12px; 
    box-sizing: border-box; 
    padding-bottom: 90px !important; /* 65px(ë‚´ë¹„) + ì—¬ìœ  */
    background-color: #f1f5f9; 
}
    
    
.nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; font-size: 11px; cursor: pointer; }
.nav-item.active { color: var(--primary-color); }
.nav-item i { font-size: 20px; margin-bottom: 4px; }

/* --- [í•µì‹¬] í˜„ì¥ í˜„í™© ê´€ë¦¬ (ì¤‘ì²© ìŠ¤ì™€ì´í¼ ìŠ¤íƒ€ì¼) --- */
#client-management-list { width: 100%; padding: 0; }

.client-management-swiper { 
    width: 100%; 
    padding-top: 5px !important; /* â¬…ï¸ ì¹´ë“œ ë¨¸ë¦¬ê°€ ë„ˆë¬´ ë¶™ëŠ”ê²Œ ì‹«ìœ¼ë©´ 5px ì •ë„ë§Œ */
    padding-bottom: 45px !important; 
}

.client-slide { width: 94% !important; display: flex; align-items: stretch; }

.client-card {
    width: 100%;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.06);
    border: none;
    display: flex;
    flex-direction: column;
    min-height: 480px; /* ì¹´ë“œê°€ ì‘ì•„ ë³´ì´ì§€ ì•Šê²Œ ìµœì†Œ ë†’ì´ ê³ ì • */
}

.client-header {
    background: #ffffff;
    padding: 20px;
    font-size: 1.15rem;
    font-weight: 800;
    color: #1e293b;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    align-items: center;
    gap: 12px;
}

.site-list { flex: 1; overflow-y: auto; padding: 5px 0; }

.site-row {
    display: flex !important;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid #f8fafc;
}

.site-content { flex: 1; text-align: left; min-width: 0; }
.site-name { font-size: 1.05rem; font-weight: 700; color: #334155; margin-bottom: 4px; }
.site-addr { font-size: 0.85rem; color: #64748b; text-decoration: underline; cursor: pointer; }

/* ì§„í–‰/ì™„ë£Œ ìƒíƒœ ë²„íŠ¼ */
.status-btn {
    padding: 10px 16px;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: bold;
    border: none;
    min-width: 80px;
    cursor: pointer;
}
.status-btn.ing { background: #eefdf3; color: #16a34a; }
.status-btn.completed { background: #f1f5f9; color: #94a3b8; }

/* ì™„ë£Œëœ í˜„ì¥ ì²˜ë¦¬ */
.status-done { opacity: 0.7; background-color: #fcfcfc; }
.status-done .site-name { text-decoration: line-through; color: #94a3b8; }

.swiper-pagination-bullet-active { background: #2563eb !important; }

/* --- ì§ì› ê´€ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ --- */
#worker-list-admin { display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; }
.worker-card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border-top: 4px solid #ddd; position: relative; display: block; }
.worker-card .name { font-size: 1.1rem; font-weight: bold; color: #333; }
.status-badge { font-size: 0.75rem; padding: 3px 8px; border-radius: 20px; color: #fff; font-weight: bold; }
.status-on { background: #2563eb; }
.status-off { background: #ef4444; }
.info { margin-top: 10px; font-size: 0.9rem; line-height: 1.6; color: #555; }
.copyable { color: #2563eb; text-decoration: underline; cursor: pointer; word-break: break-all; }
.card-btns { margin-top: 15px; display: flex; gap: 8px; }


    /* ì¹©ì´ ê°€ë¡œë¡œ ë‚˜ì—´ë˜ë„ë¡ ì„¤ì • */
#client-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 15px;
    padding: 0 5px;
}

.chip {
    padding: 8px 14px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 20px;
    font-size: 0.85rem;
    color: #555;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: all 0.2s;
}

/* ì¹© í´ë¦­ ì‹œ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
.chip.active {
    background: #2563eb;
    color: #fff;
    border-color: #2563eb;
}


    /* ì¼ì •ë“±ë¡ íŒì—… ëª¨ë‹¬ ë°°ê²½ */
.modal {
    display: none; 
    position: fixed; z-index: 1000; left: 0; top: 0;
    width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);
}

/* íŒì—…ì°½ ë³¸ì²´ */
.modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.close {
    color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
}

/* ê°„ë‹¨í•œ ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
#calendar-container {
  padding: 0;                   /* ğŸŸ¢ ì—¬ë°± 0ìœ¼ë¡œ ì„¤ì • (ê½‰ ì°¨ê²Œ) */
    background: #fff;
    min-height: 300px;
    text-align: center;
}

    /* --- ë‹¬ë ¥ í…Œë‘ë¦¬ ì œê±° ë° ê³µê°„ í™•ì¥ --- */

/* 1. ë‹¬ë ¥ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” 'ê²‰ í…Œë‘ë¦¬' ì œê±° (í•µì‹¬!) */
.fc-theme-standard .fc-scrollgrid {
    border: none !important;
}

/* 2. ìš”ì¼(ì¼,ì›”,í™”...) ë°•ìŠ¤ í…Œë‘ë¦¬ ì œê±° */
.fc-theme-standard th {
    border: none !important;
    border-bottom: 1px solid #f0f0f0 !important; /* ìš”ì¼ ì•„ë˜ì—ë§Œ ì•„ì£¼ ì—°í•œ ì¤„ ë‚¨ê¹€ */
}

/* 3. ë‚ ì§œ ì¹¸(ì…€) í…Œë‘ë¦¬ ì•„ì£¼ ì—°í•˜ê²Œ ë³€ê²½ (ì™„ì „ ì—†ì• ë©´ êµ¬ë¶„ì´ ì•ˆ ê°ˆ ìˆ˜ ìˆìŒ) */
.fc-theme-standard td {
    border: 1px solid #f8fafc !important; /* ë°°ê²½ìƒ‰ê³¼ ê±°ì˜ ë¹„ìŠ·í•œ ì—°íšŒìƒ‰ */
    border-top: none !important; /* ìœ—ì¤„ ì œê±°í•´ì„œ ì‹œì›í•˜ê²Œ */
}

/* 4. ë‹¬ë ¥ ë§¨ ì•„ë˜ìª½ ë¶ˆí•„ìš”í•œ ì—¬ë°± ì œê±° */
.fc-view-harness {
    background-color: #fff; /* ë°°ê²½ í°ìƒ‰ */
}

/* 5. (ì„ íƒì‚¬í•­) ì˜¤ëŠ˜ ë‚ ì§œ ë°°ê²½ìƒ‰ì„ ì—°í•œ íŒŒë‘ìœ¼ë¡œ ì¹ í•´ì„œ í…Œë‘ë¦¬ ì—†ì´ë„ êµ¬ë¶„ë˜ê²Œ í•¨ */
.fc-day-today {
    background-color: #eff6ff !important; 
}
    
    
  </style>
  
</head>


    
<body>
  <div class="header">âš¡ íƒ€ì´íƒ„ í†µí•© ê´€ë¦¬ì</div>


    <div class="swiper">
  <div class="swiper-wrapper">
    <div class="swiper-slide">

        
    <div class="card">
    <h3>ğŸ‘¤ ì‹ ê·œ ì¸ì› ë“±ë¡</h3>
    <input type="text" id="new-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)">
    <select id="new-role">
        <option value="ê¸°ê³µ">ê¸°ê³µ</option>
        <option value="ì¡°ê³µ">ì¡°ê³µ</option>
    </select>
    <input type="number" id="new-rate" placeholder="ì¼ë‹¹ (ìˆ«ìë§Œ)">
    <input type="text" id="new-phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ (ì˜ˆ: 010-1234-5678)">
    <input type="text" id="new-address" placeholder="ì§‘ì£¼ì†Œ">
    <input type="password" id="new-pw" placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)" maxlength="4">
    <button class="btn-blue" onclick="addWorker()">ë“±ë¡í•˜ê¸°</button>
</div>
   

    <div class="card">
        <h3>ğŸ‘¥ ì§ì› ê´€ë¦¬</h3>
        <div id="worker-list-admin">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
     </div>

      <div class="swiper-slide">
     <div class="card">
    <h3>ğŸ¢ ê±°ë˜ì²˜ ë° í˜„ì¥ ë“±ë¡</h3>
    
    <div class="copy-hint" style="margin-bottom:8px;">ê¸°ì¡´ ê±°ë˜ì²˜ ì„ íƒ (ë˜ëŠ” ì§ì ‘ ì…ë ¥)</div>
    <div id="client-chips" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px;">
        </div>
    
    <div class="input-group">
        <label>ê±°ë˜ì²˜ëª…</label>
        <input type="text" id="c_client" placeholder="ì¹©ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    
    <div class="input-group">
        <label>í˜„ì¥ëª…</label>
        <input type="text" id="c_site" placeholder="í˜„ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    
    <div class="input-group">
        <label>í˜„ì¥ ì£¼ì†Œ</label>
        <input type="text" id="c_addr" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (Dì—´ ì €ì¥)">
    </div>
    
    <button class="btn-blue" onclick="saveClient()" style="width:100%">í˜„ì¥ ë“±ë¡í•˜ê¸°</button>
</div>

<div class="card" style="margin-top:20px;">
    <h3>ğŸ“‹ í˜„ì¥ í˜„í™© ê´€ë¦¬</h3>
    <div id="client-management-list">
        </div>
</div>
    </div>

    <div class="swiper-slide">
      <div class="card">
        <h3>ğŸ“¦ ìì¬ ë§ˆìŠ¤í„° ë“±ë¡</h3>
        <label>ëŒ€ë¶„ë¥˜</label><input type="text" id="m_cat">
        <label>í’ˆëª©</label><input type="text" id="m_name">
        <label>ê·œê²©</label><input type="text" id="m_spec">
        <label>ë‹¨ìœ„</label><input type="text" id="m_unit">
        <label>ë‹¨ê°€</label><input type="number" id="m_price">
        <button onclick="saveMaterial()">ìì¬ í’ˆëª© ë“±ë¡</button>
      </div>
    </div>

   <div class="swiper-slide">
        <div id="schedule-admin" class="card swiper-no-swiping">
            <h3>ğŸ“… ì‘ì—… ì¼ì • <span style="font-size:0.8rem; color:#666; font-weight:normal;">(ë‚ ì§œ í´ë¦­: ë“±ë¡ / ë°” í´ë¦­: ìˆ˜ì •)</span></h3>
            
            <div id="calendar-container"></div>
            
            <h4 style="margin-top:25px; border-bottom:2px solid #f1f5f9; padding-bottom:10px; color:#1e293b;">ğŸ“‹ ë‹¤ê°€ì˜¤ëŠ” ìƒì„¸ ì¼ì •</h4>
            <div id="schedule-list-container" style="padding-top:10px;">
                <div style="text-align:center; padding:30px; color:#999;">ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

   <div id="schedule-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="margin-bottom:15px; display:flex; justify-content:space-between;">
            <h3 id="modal-date-title" style="margin:0; color:#2563eb;">ì¼ì • ë“±ë¡</h3>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        
        <input type="hidden" id="sched-row-id">
        <input type="hidden" id="sched-date">
        <input type="hidden" id="sched-end-date">
        <input type="hidden" id="sched-client">
        <input type="hidden" id="sched-site">
        <input type="hidden" id="sched-shift" value="ì£¼ê°„">

        <div class="input-group">
            <label>ğŸ¢ ê±°ë˜ì²˜ ì„ íƒ (ì§„í–‰ì¤‘ì¸ í˜„ì¥ë§Œ í‘œì‹œ)</label>
            <div id="sched-client-chips-area" style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px;"></div>

            <label>ğŸ—ï¸ í˜„ì¥ ì„ íƒ</label>
            <div id="sched-site-chips-area" style="background:#f8f9fa; padding:10px; border-radius:8px; margin-bottom:10px;">
                <span style="color:#aaa; font-size:0.8rem;">ê±°ë˜ì²˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</span>
            </div>

            <label>â° ê·¼ë¬´ í˜•íƒœ</label>
            <div id="shift-toggle-btn" onclick="toggleShift()" style="background:#3b82f6; color:white; padding:10px; text-align:center; border-radius:8px; font-weight:bold; cursor:pointer;">
                ğŸŒ ì£¼ê°„
            </div>

            <label style="margin-top:15px;">ğŸ‘· íˆ¬ì… ì¸ì› <span id="worker-count-display">(0ëª…)</span></label>
            <input type="hidden" id="sched-workers-text">
            
            <div id="selected-workers-box" style="min-height:40px; border:1px solid #ddd; border-radius:8px; padding:8px; display:flex; flex-wrap:wrap; gap:5px; margin-bottom:5px; background:#fff;">
                <span style="color:#aaa; font-size:0.8rem; padding:5px;">ì•„ë˜ ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ê²€ìƒ‰í•˜ì„¸ìš”.</span>
            </div>
            <input type="text" id="worker-search-input" placeholder="ğŸ” ì´ë¦„ ê²€ìƒ‰" onkeyup="filterWorkerChips()" style="margin-bottom:5px;">
            <div id="worker-chips-area" style="max-height:150px; overflow-y:auto; background:#f8f9fa; padding:10px; border-radius:8px; display:flex; flex-wrap:wrap; gap:5px;"></div>

            <label style="margin-top:15px;">ğŸš› ì°¨ëŸ‰ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</label>
            <input type="text" id="sched-car" placeholder="ì°¨ëŸ‰ ì§ì ‘ ì…ë ¥">
            <div id="car-chips-area" style="display:flex; flex-wrap:wrap; gap:5px; margin-top:5px;">
                </div>

            <label>ğŸ“ ì‘ì—…ë‚´ìš© (í„°ì¹˜í•´ì„œ ì¶”ê°€)</label>
            <div id="work-content-chips" style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:5px;"></div>
            <textarea id="sched-content" rows="2" placeholder="ì‘ì—… ë‚´ìš©"></textarea>
            
            <label>íŠ¹ì´ì‚¬í•­</label>
            <textarea id="sched-note" rows="1" placeholder="íŠ¹ì´ì‚¬í•­"></textarea>
            
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button type="button" id="btn-save" onclick="saveSchedule('add')" style="flex:2;">ì €ì¥</button>
                <button type="button" id="btn-update" onclick="saveSchedule('update')" style="flex:2; display:none;">ìˆ˜ì •</button>
                <button type="button" id="btn-delete" onclick="deleteSchedule()" style="flex:1; display:none; background:#fee2e2; color:#ef4444;">ì‚­ì œ</button>
            </div>
        </div>
    </div>
  </div>
     
      
    </div>

       </div>
</div>

<div class="bottom-nav" id="main-nav">
    <div class="nav-item active" onclick="jumpTo(0)">ğŸ‘¥ <span>ì¸ì›</span></div>
    <div class="nav-item" onclick="jumpTo(1)">ğŸ¢ <span>ê±°ë˜ì²˜</span></div>
    <div class="nav-item" onclick="jumpTo(2)">ğŸ“¦ <span>ìì¬</span></div>
    <div class="nav-item" onclick="jumpTo(3)">ğŸ“… <span>ì¼ì •</span></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    
      
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbx0r8IPhDytW9knWTEbsFRVK4HmFj5CynrD9TlXzIbOe_aSDotaATcnSzouC845NIBx/exec"; // ğŸ‘ˆ ê¼­ ë³¸ì¸ ì£¼ì†Œë¡œ ìˆ˜ì •í•˜ì„¸ìš”!
let calendar = null;
let swiper = null; // ì´ˆê¸°ê°’ì„ nullë¡œ ì„¤ì •
let globalScheduleData = [];
      let globalClientData = [];
      
      // íƒ­ í´ë¦­ ì‹œ ì´ë™ (ì¤€ë¹„ ì•ˆëìœ¼ë©´ ë‹¤ì‹œ í•œë²ˆ ì´ˆê¸°í™” ì‹œë„)
    function jumpTo(index) {
        if (!swiper) {
            console.log("ìŠ¤ì™€ì´í¼ ì¬ì—°ê²° ì‹œë„ ì¤‘...");
            initSwiper();
        }
        
        if (swiper) {
            swiper.slideTo(index);
        } else {
            alert("í™”ë©´ ì´ˆê¸°í™” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
        }
    }

      
    window.addEventListener('DOMContentLoaded', async () => { // ğŸŸ¢ ì•ì— asyncê°€ ë¶™ì–´ì•¼ í•©ë‹ˆë‹¤!
    // 1. ìŠ¤ì™€ì´í¼(íƒ­ ë©”ë‰´) ì‹¤í–‰
    initSwiper();
    
    // 2. ë‚ ì§œ ì„¤ì •
    const sDateInput = document.getElementById('s_date');
    if (sDateInput) sDateInput.valueAsDate = new Date();

    // 3. âš ï¸ ë°ì´í„° ë¡œë“œ ë° ë‹¬ë ¥ ìƒì„±
    try {
        console.log("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
        
        // ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë‹¤ ê°€ì ¸ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤ (await)
        await Promise.all([
            loadAdminData(),         // ì§ì› ëª©ë¡
            loadClientManagement(),  // ê±°ë˜ì²˜ ëª©ë¡
            loadScheduleData()       // ì¼ì • ë°ì´í„° (globalScheduleDataë¥¼ ì±„ì›€)
        ]);
      
        console.log("ë°ì´í„° ë¡œë“œ ì™„ë£Œ! ë‹¬ë ¥ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.");

       // 4. ë°ì´í„°ê°€ ì™”ì„ ë•Œë§Œ ë‹¬ë ¥ê³¼ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
        initCalendar(); 
        renderScheduleList();
        console.log("ë°ì´í„° ë¡œë”© ë° í™”ë©´ êµ¬ì„± ì™„ë£Œ");
    } catch (e) {
        console.error("ë°ì´í„° ë¡œë“œ ì¤‘ ì¼ë¶€ ì‹¤íŒ¨:", e);
        // ì—ëŸ¬ê°€ ë‚˜ë©´ ë‹¬ë ¥ì„ ë¹ˆ ìƒíƒœë¡œë¼ë„ ê·¸ë ¤ì„œ ê¸°ì ˆ ë°©ì§€
        initCalendar(); 
    }
});
      

    // ìŠ¤ì™€ì´í¼ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë³„ë„ë¡œ ë§Œë“­ë‹ˆë‹¤.
    function initSwiper() {
        const swiperContainer = document.querySelector('.swiper');
        if (!swiperContainer) return;

        swiper = new Swiper('.swiper', {
            speed: 400,
            loop: false,
            allowTouchMove: true, // ì†ê°€ë½ ìŠ¤ì™€ì´í”„ í—ˆìš©

          // ğŸŸ¢ [í•µì‹¬ 1] ì´ ì˜µì…˜ì„ ì¼œì•¼ "swiper-no-swiping" í´ë˜ìŠ¤ê°€ ì‘ë™í•©ë‹ˆë‹¤!
            noSwiping: true, 
            noSwipingClass: 'swiper-no-swiping',
          
            on: {
                slideChange: function () {
                    updateNav(this.activeIndex);
                }
            }
        });
        console.log("ìŠ¤ì™€ì´í¼ ì¤€ë¹„ ì™„ë£Œ");
    }

      
// [ë‹¬ë ¥ ë¡œì§ - ë“œë˜ê·¸/í´ë¦­ ì™„ë²½ ìˆ˜ì •]
    function initCalendar() {
        const el = document.getElementById('calendar-container');
        if (!el) return;
        
        // ë°ì´í„° ë§¤í•‘ (ì•ˆì „ì¥ì¹˜ ì¶”ê°€)
        const events = globalScheduleData.map(item => {
            let title = item.site;
            if(item.workers) {
                // ì¸ì›ìˆ˜ í‘œì‹œ ë¡œì§
                const count = item.workers.split(',').length;
                title += ` (${count}ëª…)`;
            }
            return {
                id: item.rowId, title: title, start: item.date,
                backgroundColor: item.shift === 'ì•¼ê°„' ? '#475569' : '#3b82f6',
                borderColor: 'transparent', extendedProps: item
            };
        });

        if (calendar) calendar.destroy();
        calendar = new FullCalendar.Calendar(el, {
            initialView: 'dayGridMonth', locale: 'ko', height: 'auto',
          locale: 'ko',
            height: 'auto',

          // ğŸŸ¢ [í•µì‹¬ 3] í„°ì¹˜ ë¯¼ê°ë„ ìµœëŒ€ë¡œ ì„¤ì • (ì¦‰ì‹œ ë°˜ì‘)
            longPressDelay: 0, 
            eventLongPressDelay: 0,
            selectLongPressDelay: 200,
          
            headerToolbar: { left: 'prev', center: 'title', right: 'next' },
            dayCellContent: (info) => ({ html: info.dayNumberText.replace('ì¼', '') }),
          
            
            selectable: true,  // ë“œë˜ê·¸ í—ˆìš©
            selectMirror: true, 
            
            // ë‚ ì§œ í´ë¦­/ë“œë˜ê·¸ ì‹œ ì‹¤í–‰
            select: (info) => openModal('add', info.startStr, null, info.endStr),
            
            // ê¸°ì¡´ ì¼ì • í´ë¦­ ì‹œ ì‹¤í–‰
            eventClick: (info) => openModal('edit', null, info.event.extendedProps),
     events: events
        });
        calendar.render();
    }
  

    

   function updateNav(index) {
    // ëª¨ë“  ë‚´ë¹„ ì•„ì´í…œì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const navItems = document.querySelectorAll('.nav-item');
    
    navItems.forEach((item, i) => {
        // í˜„ì¬ ìŠ¬ë¼ì´ë“œ ë²ˆí˜¸ì™€ ì•„ì´ì½˜ ë²ˆí˜¸ê°€ ê°™ìœ¼ë©´ active ì¶”ê°€
        if (i === index) {
            item.classList.add('active');
            console.log(i + "ë²ˆ ë‚´ë¹„ í™œì„±í™”"); // ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸ìš©
        } else {
            item.classList.remove('active');
        }
    });
}
// [3] ì¼ì • ë°ì´í„° ë¡œë“œ (ì„œë²„ í†µì‹ ) - ì•ˆì „ì¥ì¹˜ ë³´ê°•
async function loadScheduleData() {
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'getScheduleList' }) 
        });
        
        // ì„œë²„ ì‘ë‹µì„ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ë°›ì•„ì„œ í™•ì¸
        const text = await res.text();
        let data;
        
        try {
            data = JSON.parse(text); // JSONìœ¼ë¡œ ë³€í™˜ ì‹œë„
        } catch (e) {
            console.error("ì„œë²„ ì‘ë‹µì´ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤:", text);
            data = []; // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ˆê¸°í™”
        }

        // â­ í•µì‹¬: ë°ì´í„°ê°€ ë¦¬ìŠ¤íŠ¸(Array)ì¸ì§€ í™•ì¸í•˜ê³  ì•„ë‹ˆë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸[] ëŒ€ì…
        globalScheduleData = Array.isArray(data) ? data : [];
        return globalScheduleData;

    } catch (e) { 
        console.error("ë„¤íŠ¸ì›Œí¬ í†µì‹  ì‹¤íŒ¨:", e); 
        globalScheduleData = []; // í†µì‹  ì—ëŸ¬ ì‹œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ˆê¸°í™”
        return [];
    }
}



   // [4] ì¼ì • ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ í•„í„°ë§ ì ìš©)
    function renderScheduleList() {
        const box = document.getElementById('schedule-list-container');
        if (!box) return;

        // 1. ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸° (YYYY-MM-DD í¬ë§·)
        const d = new Date();
        const today = d.getFullYear() + "-" + 
                      String(d.getMonth() + 1).padStart(2, '0') + "-" + 
                      String(d.getDate()).padStart(2, '0');
        
        // 2. í•„í„°ë§: ì˜¤ëŠ˜ ë‚ ì§œë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€(>=) ì¼ì •ë§Œ ë‚¨ê¹€
        // 3. ì •ë ¬: ê°€ê¹Œìš´ ë‚ ì§œë¶€í„° ë¨¼ ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬
        const list = (Array.isArray(globalScheduleData) ? globalScheduleData : [])
            .filter(item => item.date >= today) 
            .sort((a, b) => new Date(a.date) - new Date(b.date));

        // ì¼ì •ì´ ì—†ì„ ë•Œ í‘œì‹œ
        if (list.length === 0) {
            box.innerHTML = '<div style="padding:40px; text-align:center; color:#999;">ğŸ“… ì˜¤ëŠ˜ ì´í›„ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        // ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
        box.innerHTML = list.map(item => {
            // ì˜¤ëŠ˜ ì¼ì •ì¸ì§€ í™•ì¸í•´ì„œ 'ì˜¤ëŠ˜' ë±ƒì§€ ë‹¬ì•„ì£¼ê¸°
            const isToday = item.date === today;
            const todayBadge = isToday ? '<span style="background:#ef4444; color:white; font-size:0.7rem; padding:2px 6px; border-radius:4px; margin-left:5px;">Today</span>' : '';

            return `
            <div class="card" style="margin-bottom:10px; padding:15px; border-left:5px solid ${item.shift==='ì•¼ê°„'?'#475569':'#2563eb'}; cursor:pointer;" 
                 onclick='openModal("edit", null, ${JSON.stringify(item).replace(/'/g, "&#39;")})'>
                
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-weight:bold; font-size:1.1rem; color:#333;">
                        ${item.date} 
                        <span style="font-size:0.8rem; background:#eee; padding:2px 5px; border-radius:4px; font-weight:normal; color:#555;">${item.shift}</span>
                        ${todayBadge}
                    </div>
                </div>

                <div style="font-size:1.05rem; margin-top:8px; font-weight:bold; color:#1e293b;">
                    ${item.site} <span style="color:#64748b; font-weight:normal; font-size:0.9rem;">(${item.client})</span>
                </div>

                <div style="font-size:0.9rem; color:#666; margin-top:6px; display:flex; gap:10px;">
                    <span>ğŸ‘· ${item.workers || 'ë¯¸ì •'}</span>
                    <span style="color:#ddd;">|</span>
                    <span>ğŸš› ${item.car || '-'}</span>
                </div>
            </div>
            `;
        }).join('');
    }


   // [1] í†µí•© íŒì—… ì—´ê¸° í•¨ìˆ˜
    function openModal(mode, dateStr, data, endStr = null) {
        const modal = document.getElementById('schedule-modal');
        if (!modal) return;
        modal.style.display = 'block';

        if (mode === 'add') {
            document.getElementById('sched-date').value = dateStr;
            document.getElementById('sched-end-date').value = endStr || "";
            
            let titleText = dateStr + " ì¼ì • ë“±ë¡";
            if (endStr) {
                const s = new Date(dateStr);
                const e = new Date(endStr);
                const diff = (e - s) / (1000 * 60 * 60 * 24);
                if (diff > 1) titleText = `${dateStr} ~ (${Math.ceil(diff)}ì¼ê°„ ì—°ì†)`;
            }
            document.getElementById('modal-date-title').innerText = titleText;

            resetForm();
            
            // ğŸŸ¢ ì¹© ì´ˆê¸°í™” (ë¹ˆ ê°’ìœ¼ë¡œ ì‹œì‘)
            renderChips('', '');          // ê±°ë˜ì²˜/í˜„ì¥
            renderWorkerChips("");        // ì¸ì›
            renderVehicleChips("");       // ì°¨ëŸ‰
            renderWorkPresets();          // ì‘ì—…ë‚´ìš© í”„ë¦¬ì…‹

            currentShiftIndex = 0; updateShiftBtn();

            document.getElementById('btn-save').style.display = 'block';
            document.getElementById('btn-update').style.display = 'none';
            document.getElementById('btn-delete').style.display = 'none';

        } else {
            document.getElementById('modal-date-title').innerText = "ì¼ì • ìˆ˜ì •";
            document.getElementById('sched-row-id').value = data.rowId;
            document.getElementById('sched-date').value = data.date;
            document.getElementById('sched-end-date').value = "";

            document.getElementById('sched-car').value = data.car || "";
            document.getElementById('sched-content').value = data.content || "";
            document.getElementById('sched-note').value = data.note || "";

            const shiftIdx = SHIFT_TYPES.indexOf(data.shift);
            currentShiftIndex = shiftIdx >= 0 ? shiftIdx : 0;
            updateShiftBtn();

            // ğŸŸ¢ ë°ì´í„° ë³µêµ¬ (ê¸°ì¡´ ê°’ ë„£ê¸°)
            renderChips(data.client, data.site);
            renderWorkerChips(data.workers || "");
            renderVehicleChips(data.car || "");
            renderWorkPresets();

            document.getElementById('btn-save').style.display = 'none';
            document.getElementById('btn-update').style.display = 'block';
            document.getElementById('btn-delete').style.display = 'block';
        }
    }

    function closeModal() { document.getElementById('schedule-modal').style.display = "none"; }

      


      
      


     // [2] ê±°ë˜ì²˜/í˜„ì¥ ì¹© (ì§„í–‰ì¤‘ì¸ í˜„ì¥ë§Œ í•„í„°ë§!)
    function renderChips(sClient, sSite) {
        const cBox = document.getElementById('sched-client-chips-area');
        const sBox = document.getElementById('sched-site-chips-area');
        
        // ğŸŸ¢ 'ì§„í–‰ì¤‘' ìƒíƒœì´ê±°ë‚˜, í˜„ì¬ ì„ íƒëœ(ìˆ˜ì • ëª¨ë“œ) í˜„ì¥ë§Œ í¬í•¨
        const activeData = globalClientData.filter(item => 
            item.status !== 'ì™„ë£Œ' || (item.client === sClient && item.site === sSite)
        );

        const uniques = [...new Set(activeData.map(i => i.client))];

        if (cBox) {
            cBox.innerHTML = uniques.map(c => 
                `<div class="chip ${c === sClient ? 'active' : ''}" onclick="clkClient(this, '${c}')">${c}</div>`
            ).join('');
        }
        document.getElementById('sched-client').value = sClient || "";

        if (sClient) {
            // ì„ íƒëœ ê±°ë˜ì²˜ì˜ í˜„ì¥ ì¤‘ 'ì§„í–‰ì¤‘'ì¸ ê²ƒë§Œ
            const sites = activeData.filter(i => i.client === sClient);
            if (sBox) {
                sBox.innerHTML = sites.map(s => 
                    `<div class="chip ${s.site === sSite ? 'active' : ''}" onclick="clkSite(this, '${s.site}')">${s.site}</div>`
                ).join('');
            }
            document.getElementById('sched-site').value = sSite || "";
        } else {
            if (sBox) sBox.innerHTML = '<span style="color:#aaa; font-size:0.8rem;">ê±°ë˜ì²˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</span>';
        }
    }
      

      // [3] ì°¨ëŸ‰ ì¤‘ë³µ ì„ íƒ ë¡œì§
    const VEHICLE_LIST = ["ë´‰ê³ ", "ìŠ¤íƒ€ë ‰ìŠ¤", "ìŠ¤íƒ€ë¦¬ì•„", "M4"]; // ğŸ‘ˆ ì‚¬ì¥ë‹˜ ì°¨ ì¢…ë¥˜ ìˆ˜ì • ê°€ëŠ¥

    function renderVehicleChips(currentVal) {
        const box = document.getElementById('car-chips-area');
        // í˜„ì¬ ì…ë ¥ëœ ê°’ ("1í˜¸ì°¨, 2í˜¸ì°¨")ì„ ë°°ì—´ë¡œ ë¶„ë¦¬
        const selected = currentVal ? currentVal.split(',').map(s=>s.trim()) : [];
        
        if(box) {
            box.innerHTML = VEHICLE_LIST.map(car => {
                const isActive = selected.includes(car);
                return `<div class="chip ${isActive ? 'active' : ''}" onclick="toggleCar(this, '${car}')">${car}</div>`;
            }).join('');
        }
        document.getElementById('sched-car').value = currentVal;
    }

      function toggleCar(el, carName) {
        el.classList.toggle('active');
        
        // í˜„ì¬ ì„ íƒëœ ëª¨ë“  ì°¨ëŸ‰ ì¹©ì„ ì°¾ì•„ì„œ í…ìŠ¤íŠ¸ë¡œ í•©ì¹¨
        const activeChips = document.querySelectorAll('#car-chips-area .chip.active');
        const result = Array.from(activeChips).map(c => c.innerText).join(', ');
        
        // ì…ë ¥ì°½ì— ë°˜ì˜ (ìˆ˜ê¸° ì…ë ¥ë„ ê°€ëŠ¥í•˜ë„ë¡ ë®ì–´ì“°ê¸°ë³´ë‹¤ëŠ” ê°±ì‹ )
        document.getElementById('sched-car').value = result;
    }

      // [4] ì‘ì—…ë‚´ìš© í”„ë¦¬ì…‹ (ë°˜ë³µ ê³µì •)
    // ğŸ‘ˆ ì—¬ê¸°ì— ìì£¼ ì“°ëŠ” ì‘ì—… ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”!
    const WORK_PRESETS = ["ì–‘ì¤‘", "í¬ì„¤", "ë‹¨ë§", "íŠ¸ë ˆì´", "ì…ì„ ", "ê²°ì„ ", "ìŠ¤í‹¸ë°°ê´€", "ë ˆì´ìŠ¤ì›¨ì´", "ì² ê±°", "ìì¬ì •ë¦¬"];

    function renderWorkPresets() {
        const box = document.getElementById('work-content-chips');
        if(box) {
            box.innerHTML = WORK_PRESETS.map(text => 
                `<div class="chip" style="background:#f3f4f6; color:#555; border:1px solid #ddd;" onclick="addWorkContent('${text}')">+ ${text}</div>`
            ).join('');
        }
    }

    function addWorkContent(text) {
        const input = document.getElementById('sched-content');
        if(input.value) {
            input.value += ", " + text; // ì´ë¯¸ ê¸€ìê°€ ìˆìœ¼ë©´ ì½¤ë§ˆ ì°ê³  ì¶”ê°€
        } else {
            input.value = text;
        }
    }
      

      
      
    function clickSchedSite(el, siteName) {
        document.getElementById('sched-site').value = siteName;
        const siblings = document.getElementById('sched-site-chips-area').children;
        for(let s of siblings) s.classList.remove('active');
        el.classList.add('active');
    }
    
   function resetForm() {
        // 1. ê¸°ë³¸ í…ìŠ¤íŠ¸ ì…ë ¥ì°½ ì´ˆê¸°í™” (ì•ˆì „í•˜ê²Œ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì§€ì›€)
        const ids = ['sched-client', 'sched-site', 'sched-car', 'sched-content', 'sched-note'];
        ids.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = "";
        });

        // 2. ì¸ì› ê´€ë ¨ ì´ˆê¸°í™” (ì—…ê·¸ë ˆì´ë“œëœ ì¹© ë¡œì§ ë°˜ì˜)
        // (1) ìˆ¨ê²¨ì§„ ì €ì¥ê°’ ì´ˆê¸°í™”
        const hiddenInput = document.getElementById('sched-workers-text');
        if (hiddenInput) hiddenInput.value = "";

        // (2) ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
        const searchInput = document.getElementById('worker-search-input');
        if (searchInput) searchInput.value = "";

        // (3) ì„ íƒëœ ëª…ë‹¨(Set) ë¹„ìš°ê¸° ë° í™”ë©´ ê°±ì‹ 
        if (typeof selectedWorkerSet !== 'undefined') {
            selectedWorkerSet.clear(); // ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ì„ íƒ ëª…ë‹¨ ì‚­ì œ
        }
        
        // (4) ì¹© í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸° (ë¹ˆ ìƒíƒœë¡œ)
        if (typeof renderWorkerChips === 'function') {
            renderWorkerChips(""); 
        }
    }

  // [ì €ì¥ ë¡œì§ - í•˜ë£¨/ì—°ì† ìë™ ë¶„ê¸°]
    async function saveSchedule(mode) {
        const payload = {
            date: document.getElementById('sched-date').value,
            client: document.getElementById('sched-client').value,
            site: document.getElementById('sched-site').value,
            shift: document.getElementById('sched-shift').value,
            workers: document.getElementById('sched-workers-text').value,
            car: document.getElementById('sched-car').value,
            content: document.getElementById('sched-content').value,
            note: document.getElementById('sched-note').value
        };

        if(!payload.client || !payload.site) return alert("ê±°ë˜ì²˜ì™€ í˜„ì¥ì„ ì„ íƒí•˜ì„¸ìš”.");

        let action = 'addSchedule';
        let dataToSend = payload;
        const endDateStr = document.getElementById('sched-end-date').value;

        // ë“œë˜ê·¸(ì—°ì†) ë“±ë¡ì¸ ê²½ìš°
        if (mode === 'add' && endDateStr) {
            action = 'addScheduleBatch';
            const list = [];
            let cur = new Date(payload.date);
            const end = new Date(endDateStr);
            
            // í•˜ë£¨ì”© ì¦ê°€ì‹œí‚¤ë©° ë¦¬ìŠ¤íŠ¸ ìƒì„±
            while(cur < end) {
                list.push({...payload, date: cur.toISOString().split('T')[0]});
                cur.setDate(cur.getDate()+1);
            }
            dataToSend = list;
        } else if (mode === 'update') {
            action = 'updateSchedule';
            payload.rowId = document.getElementById('sched-row-id').value;
        }

        await sendToGas(action, dataToSend);
        closeModal();
    }

    // [ì‚­ì œ]
    async function deleteSchedule() {
        if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const rowId = document.getElementById('sched-row-id').value;
        await sendToGas('deleteSchedule', { rowId });
        closeModal();
    }
      

      
      
    // 5. [í•µì‹¬ ìˆ˜ì •] ì„œë²„ ì „ì†¡ ê³µí†µ í•¨ìˆ˜ (async ìœ„ì¹˜ í™•ì¸)
    async function sendToGas(action, data) {
        try {
            const res = await fetch(GAS_URL, {
                method: 'POST',
                body: JSON.stringify({ action: action, data: data }),
                redirect: 'follow'
            });
            const text = await res.text();
            if (text.includes("SUCCESS")) {
                alert("âœ… ë“±ë¡ ì™„ë£Œ!");

              // âœ… ëŒ€ì‹  í˜„ì¬ íƒ­ì„ ìœ ì§€í•˜ë©´ì„œ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
            if (action === 'adminAddClient' || action === 'updateSiteStatus' || action === 'updateSiteAddress') {
                loadClientManagement(); // ê±°ë˜ì²˜ ë¦¬ìŠ¤íŠ¸ë§Œ ê°±ì‹ 
            } else if (action === 'adminAddWorker' || action === 'adminUpdateStatus' || action === 'adminUpdatePassword') {
                loadAdminData(); // ì§ì› ë¦¬ìŠ¤íŠ¸ë§Œ ê°±ì‹ 
            }
            
            // ì…ë ¥ì°½ ë¹„ìš°ê¸° (ì„ íƒ ì‚¬í•­)
            clearInputs(action);
              
            } else {
                alert("âš ï¸ ê²°ê³¼: " + text);
            }
        } catch (e) {
            alert("ğŸš¨ í†µì‹  ì—ëŸ¬: " + e.message);
        }
    }

      function clearInputs(action) {
    if (action === 'adminAddClient') {
        document.getElementById('c_client').value = "";
        document.getElementById('c_site').value = "";
        document.getElementById('c_addr').value = "";
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    }
    // í•„ìš”í•œ ë‹¤ë¥¸ ì…ë ¥ì°½ë“¤ë„ ì—¬ê¸°ì— ì¶”ê°€ ê°€ëŠ¥
}

      async function saveClient() {
    const btn = event.target; // í´ë¦­í•œ ë²„íŠ¼
    const data = {
        client: document.getElementById('c_client').value,
        site: document.getElementById('c_site').value,
        address: document.getElementById('c_addr').value
    };
    if(!data.client || !data.site) return alert("ê±°ë˜ì²˜ì™€ í˜„ì¥ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");

    btn.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
    btn.innerText = "â³ ë“±ë¡ ì¤‘...";
    
    await sendToGas('adminAddClient', data);
    
    btn.disabled = false;
    btn.innerText = "í˜„ì¥ ë“±ë¡í•˜ê¸°";
}
      



// ìì¬ ë“±ë¡ ë²„íŠ¼ìš©
function saveMaterial() {
    const data = {
        cat: document.getElementById('m_cat').value,
        name: document.getElementById('m_name').value,
        spec: document.getElementById('m_spec').value,
        unit: document.getElementById('m_unit').value,
        price: document.getElementById('m_price').value
    };
    if(!data.name) return alert("í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    sendToGas('adminAddMaterial', data);
}


        
        let globalWorkerData = []; // ğŸŸ¢ ë§¨ ìœ„ì— ì´ê±° í•œ ì¤„ ì¶”ê°€í•˜ì„¸ìš”!
      
   // 1. ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸° (async í‚¤ì›Œë“œê°€ í•µì‹¬!)
async function loadAdminData() {
    const box = document.getElementById('worker-list-admin');
    box.innerHTML = "â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'getAllWorkerInfo' }),
            redirect: 'follow' 
        });
        const text = await res.text();
        const workers = JSON.parse(text);
        
        globalWorkerData = workers; // ğŸŸ¢ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (íŒì—…ì—ì„œ ì“°ë ¤ê³ )
        
   box.innerHTML = workers.map(w => `
    <div class="worker-card" style="border-top-color: ${w.status === 'ì¬ì§' ? '#2563eb' : '#ef4444'}">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="name">${w.name} <span style="font-size:0.8rem; font-weight:normal;">(${w.role})</span></div>
            <span class="status-badge ${w.status === 'ì¬ì§' ? 'status-on' : 'status-off'}">${w.status}</span>
        </div>
        
        <div class="info">
            <div class="copy-hint">ğŸ“± íœ´ëŒ€í°</div>
            <div class="copyable" onclick="copyText('${w.phone}')">${w.phone || 'ë²ˆí˜¸ ì—†ìŒ'}</div>
            
            <div class="copy-hint" style="margin-top:8px;">ğŸ  ì§‘ì£¼ì†Œ</div>
            <div class="copyable" onclick="copyText('${w.address}')">${w.address || 'ì£¼ì†Œ ì—†ìŒ'}</div>
            
            <div style="margin-top:10px; display:flex; justify-content:space-between;">
                <span>ğŸ’° ë‹¨ê°€: <b>${Number(w.rate).toLocaleString()}</b></span>
                <span style="background:#eee; padding:2px 5px; border-radius:4px;">ğŸ”‘ PW: ${w.pw}</span>
            </div>
        </div>

        <div class="card-btns">
            <button class="btn-sm btn-outline" onclick="changePassword('${w.name}')">ë¹„ë²ˆë³€ê²½</button>
            <button class="btn-sm btn-red" onclick="updateStatus('${w.name}', '${w.status === 'ì¬ì§' ? 'í‡´ì‚¬' : 'ì¬ì§'}')">
                ${w.status === 'ì¬ì§' ? 'í‡´ì§ì²˜ë¦¬' : 'ë³µêµ¬í•˜ê¸°'}
            </button>
        </div>
    </div>
`).join('');
    } catch (e) {
        console.error(e);
        box.innerHTML = `<p style="color:red">âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (CORS ë˜ëŠ” ë¬¸ë²• ì—ëŸ¬)</p>`;
    }
}
          

     // 2. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í•¨ìˆ˜
        async function changePassword(name) {
            const newPw = prompt(`${name}ë‹˜ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.`);
            if (!newPw || newPw.length !== 4 || isNaN(newPw)) return alert("ìˆ«ì 4ìë¦¬ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.");

            if (confirm(`${name}ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ [${newPw}]ë¡œ ë³€ê²½í• ê¹Œìš”?`)) {
                try {
                    await fetch(GAS_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ action: 'adminUpdatePassword', userName: name, newPw: newPw }),
                        redirect: 'follow'
                    });
                    alert("âœ… ë³€ê²½ ì™„ë£Œ!");
                    loadAdminData();
                } catch (e) { alert("ë¹„ë²ˆ ë³€ê²½ ì‹¤íŒ¨"); }
            }
        }

        
      // 3. ì‹ ê·œ ì¸ì› ë“±ë¡ í•¨ìˆ˜
      async function addWorker() {
    const data = {
        name: document.getElementById('new-name').value,
        role: document.getElementById('new-role').value,
        rate: document.getElementById('new-rate').value,
        phone: document.getElementById('new-phone').value, // ì¶”ê°€
        address: document.getElementById('new-address').value, // ì¶”ê°€
        pw: document.getElementById('new-pw').value
    };

    if(!data.name || !data.pw) return alert("ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    
    try {
        await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'adminAddWorker', data }),
            redirect: 'follow' 
        });
        alert("âœ… ë“±ë¡ ì™„ë£Œ!");
        location.reload(); // ìƒˆë¡œê³ ì¹¨í•´ì„œ ëª©ë¡ ê°±ì‹ 
    } catch (e) { 
        alert("ë“±ë¡ ì‹¤íŒ¨: " + e.toString()); 
    }
}
        

    // 4. ìƒíƒœ ë³€ê²½ í•¨ìˆ˜ (í‡´ì‚¬/ì¬ì§)
        async function updateStatus(name, newStatus) {
            if(!confirm(`${name}ë‹˜ì„ ${newStatus} ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            try {
                await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: 'adminUpdateStatus', userName: name, status: newStatus }),
                    redirect: 'follow'
                });
                loadAdminData();
            } catch (e) { alert("ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨"); }
        }

        window.onload = loadAdminData;
      

        function copyText(text) {
    if (!text) return;
    navigator.clipboard.writeText(text).then(() => {
        alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤: " + text);
    });
}

      // 1. ê±°ë˜ì²˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì¹© ìƒì„± ë° ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
let clientSwiper = null; // ê±°ë˜ì²˜ ìŠ¤ì™€ì´í¼ ì „ì—­ ë³€ìˆ˜

async function loadClientManagement() {

  
    const listBox = document.getElementById('client-management-list');
    const chipBox = document.getElementById('client-chips'); // ì¹©ì´ ë“¤ì–´ê°ˆ ì˜ì—­
    
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ action: 'getClientListData' }) 
        });
        const data = await res.json(); 

        // 1. ê±°ë˜ì²˜ ì¹© ìƒì„± (ì¤‘ë³µ ì œê±°)
        const uniqueClients = [...new Set(data.map(item => item.client))];
        if (chipBox) {
            chipBox.innerHTML = uniqueClients.map(client => 
                // ì¹© í´ë¦­ ì‹œ selectClientChip í•¨ìˆ˜ ì‹¤í–‰ (ì…ë ¥ì°½ ìë™ì™„ì„±ìš©)
                `<div class="chip" onclick="selectClientChip(this, '${client}')">${client}</div>`
            ).join('');
        }

        // 2. ë°ì´í„° ê·¸ë£¹í™”
        const grouped = data.reduce((acc, curr) => {
            if (!acc[curr.client]) acc[curr.client] = [];
            acc[curr.client].push(curr);
            return acc;
        }, {});

        // 3. ìŠ¤ì™€ì´í¼ HTML ìƒì„±
        let html = `
            <div class="swiper client-management-swiper">
                <div class="swiper-wrapper">`;
        
        for (const client in grouped) {
            html += `
                <div class="swiper-slide client-slide">
                    <div class="client-card">
                        <div class="client-header">ğŸ¢ ${client}</div>
                        <div class="site-list">
                            ${grouped[client].map(item => `
                                <div class="site-row ${item.status === 'ì™„ë£Œ' ? 'status-done' : ''}">
                                    <div class="site-content">
                                        <div class="site-name">${item.site}</div>
                                        <div class="site-addr" onclick="editAddress('${item.client}', '${item.site}', '${item.address || ''}')">
                                            ğŸ“ ${item.address || 'ì£¼ì†Œ ë“±ë¡'}
                                        </div>
                                    </div>
                                    <div class="site-action">
                                        <button class="status-btn ${item.status === 'ì™„ë£Œ' ? 'completed' : 'ing'}" 
                                                onclick="toggleSiteStatus('${item.client}', '${item.site}', '${item.status}')">
                                            ${item.status || 'ì§„í–‰ì¤‘'}
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>`;
        }
        
        html += `</div>
                <div class="swiper-pagination"></div>
            </div>`;
        
        listBox.innerHTML = html;

        // 4. ìŠ¤ì™€ì´í¼ ì´ˆê¸°í™” (ì´ë™ ê¸°ëŠ¥ ì—†ì´ ë ˆì´ì•„ì›ƒë§Œ ìœ ì§€)
        if (window.clientSwiper) window.clientSwiper.destroy();
        window.clientSwiper = new Swiper('.client-management-swiper', {
            slidesPerView: 'auto',
            centeredSlides: true,
            spaceBetween: 15,
            nested: true,
            pagination: { el: '.swiper-pagination', clickable: true }
        });

    } catch (e) { console.error(e); }
}

// ì¹© ì„ íƒ ì‹œ ì…ë ¥ì°½ì— ì´ë¦„ ë„£ì–´ì£¼ëŠ” í•¨ìˆ˜
function selectClientChip(el, name) {
    // 1. ê±°ë˜ì²˜ ë“±ë¡ ì…ë ¥ë€ì— ê°’ ë„£ê¸°
    const clientInput = document.getElementById('c_client');
    if (clientInput) {
        clientInput.value = name;
        // ì…ë ¥ì°½ìœ¼ë¡œ í™”ë©´ ìŠ¤í¬ë¡¤ (í•„ìš”í•  ê²½ìš°ë§Œ)
        clientInput.focus();
    }

    // 2. ì¹© ì„ íƒ í‘œì‹œ (ìƒ‰ìƒ ë³€ê²½)
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    el.classList.add('active');
}

// 2-2. í˜„ì¥ ìƒíƒœ ë³€ê²½ (ì§„í–‰ì¤‘ <-> ì™„ë£Œ)
async function toggleSiteStatus(client, site, currentStatus) {
    const newStatus = currentStatus === 'ì™„ë£Œ' ? 'ì§„í–‰ì¤‘' : 'ì™„ë£Œ';
    if(!confirm(`[${site}] í˜„ì¥ì„ ${newStatus} ìƒíƒœë¡œ ë³€ê²½í• ê¹Œìš”?`)) return;
    
    await sendToGas('updateSiteStatus', { client, site, status: newStatus });
    loadClientManagement(); // ìƒˆë¡œê³ ì¹¨
}

// 2-3. ì£¼ì†Œ ìˆ˜ì • ê¸°ëŠ¥
async function editAddress(client, site, oldAddr) {
    const newAddr = prompt(`[${site}]ì˜ ìƒˆ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”:`, oldAddr);
    if (newAddr === null || newAddr === oldAddr) return;
    
    await sendToGas('updateSiteAddress', { client, site, address: newAddr });
    loadClientManagement();
}



      // ==========================================
    // [UI í—¬í¼ í•¨ìˆ˜ë“¤] ì¼ì • ë“±ë¡ íŒì—… ì‘ë™ìš©
    // ==========================================

    const SHIFT_TYPES = ['ì£¼ê°„', 'ì•¼ê°„', 'ì¡°ì¶œ'];
    let currentShiftIndex = 0;
    
    // 1. ì£¼/ì•¼/ì¡°ì¶œ ë²„íŠ¼ í† ê¸€ (í´ë¦­í•  ë•Œë§ˆë‹¤ ê¸€ì/ìƒ‰ìƒ ë³€ê²½)
    function toggleShift() {
        currentShiftIndex = (currentShiftIndex + 1) % SHIFT_TYPES.length;
        updateShiftBtn();
    }

    function updateShiftBtn() {
        const s = SHIFT_TYPES[currentShiftIndex];
        document.getElementById('sched-shift').value = s; // ìˆ¨ê²¨ì§„ inputì— ê°’ ì €ì¥
        
        const btn = document.getElementById('shift-toggle-btn');
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        btn.innerText = (s === 'ì£¼ê°„' ? 'ğŸŒ ' : s === 'ì•¼ê°„' ? 'ğŸŒ™ ' : 'ğŸŒ… ') + s;
        // ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½ (ì£¼ê°„:íŒŒë‘, ì•¼ê°„:íšŒìƒ‰, ì¡°ì¶œ:ì˜¤ë Œì§€)
        btn.style.backgroundColor = s === 'ì£¼ê°„' ? '#3b82f6' : (s === 'ì•¼ê°„' ? '#475569' : '#f59e0b');
    }
    
    // 2. ì°¨ëŸ‰ ì¹© ì„ íƒ
    function selectCar(val) { 
        document.getElementById('sched-car').value = val; 
    }

// [ìˆ˜ì •ëœ ì¹© ë Œë”ë§ í•¨ìˆ˜] - 'ì¬ì§' í•„í„°ë§ ì¶”ê°€
    function renderWorkerChips(namesStr) {
        const container = document.getElementById('worker-chips-area');
        
        // 1. ë©”ëª¨ë¦¬ ì´ˆê¸°í™”
        selectedWorkerSet.clear(); 

        // 2. ê¸°ì¡´ ì„ íƒëœ ì¸ì› ë³µêµ¬
        if (namesStr) {
            namesStr.split(',').map(s => s.trim()).forEach(name => {
                if(name) selectedWorkerSet.add(name);
            });
        }
        
        // 3. ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
        const searchInput = document.getElementById('worker-search-input');
        if(searchInput) searchInput.value = "";

        // 4. ì „ì²´ ì§ì›(í›„ë³´êµ°) ê·¸ë¦¬ê¸° - ğŸŸ¢ ì—¬ê¸°ì„œ 'ì¬ì§'ë§Œ ê±¸ëŸ¬ëƒ…ë‹ˆë‹¤!
        if(container) {
            container.innerHTML = globalWorkerData
                .filter(w => w.status === 'ì¬ì§') // ğŸ‘ˆ [í•µì‹¬] ìƒíƒœê°€ 'ì¬ì§'ì¸ ì‚¬ëŒë§Œ í†µê³¼!
                .map(w => {
                    // ì´ë¯¸ ì„ íƒëœ ì‚¬ëŒì€ ëª©ë¡ì—ì„œ ìˆ¨ê¹€
                    const isSelected = selectedWorkerSet.has(w.name);
                    const displayStyle = isSelected ? "display:none;" : ""; 
                    
                    return `<div class="chip worker-candidate" 
                                 data-name="${w.name}" 
                                 onclick="addWorkerToSelection('${w.name}')"
                                 style="background:#fff; border:1px solid #ddd; padding:5px 10px; ${displayStyle}">
                                ${w.name}
                            </div>`;
                }).join('');
        }
        
        // 5. ì„ íƒëœ ì˜ì—­ ê·¸ë¦¬ê¸°
        renderSelectedBox();
        
        // 6. ë°ì´í„° ë™ê¸°í™”
        updateWorkerInput();
    }
    
    // ì§ì› ì¹© í´ë¦­ ì‹œ (ì„ íƒ/í•´ì œ í† ê¸€)
    function toggleWorker(el, name) {
        el.classList.toggle('active'); // ìƒ‰ìƒ ë³€ê²½
        
        // í˜„ì¬ ì„ íƒëœ ëª¨ë“  ì¹©ì˜ ì´ë¦„ì„ ê¸ì–´ëª¨ìŒ
        const actives = document.querySelectorAll('#worker-chips-area .chip.active');
        // "í™ê¸¸ë™, ê¹€ì² ìˆ˜" í˜•íƒœë¡œ í•©ì³ì„œ inputì— ë„£ìŒ
        document.getElementById('sched-workers-text').value = Array.from(actives).map(c=>c.innerText).join(', ');
        
        updateWorkerCount();
    }
    
    // ì¸ì› ìˆ˜ í‘œì‹œ (ì˜ˆ: 3ëª…)
    function updateWorkerCount() {
        const cnt = document.querySelectorAll('#worker-chips-area .chip.active').length;
        const display = document.getElementById('worker-count-display');
        if(display) display.innerText = `(${cnt}ëª…)`;
    }

   
    // ê±°ë˜ì²˜ ì¹© í´ë¦­
    function clkClient(el, name) { 
        document.getElementById('sched-client').value = name; 
        renderChips(name, ''); // ê±°ë˜ì²˜ë¥¼ ë°”ê¾¸ë©´ í˜„ì¥ ì„ íƒì€ ì´ˆê¸°í™”
    }
    
    // í˜„ì¥ ì¹© í´ë¦­
    function clkSite(el, name) { 
        document.getElementById('sched-site').value = name; 
        // í˜•ì œ ìš”ì†Œë“¤ì˜ active ì œê±°í•˜ê³  ë‚˜ë§Œ active ì¶”ê°€
        Array.from(el.parentNode.children).forEach(c=>c.classList.remove('active'));
        el.classList.add('active');
    }

        
    </script>
</body>
</html>
