<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://github.com/westzero0/titan-work/blob/main/192.png?raw=true">

    <title>타이탄 일보 v3.5</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; --chip-bg: #f1f5f9; }
        body {
        font-family: -apple-system, sans-serif; 
        background: var(--bg); 
        color: var(--text); 
        margin: 0; 
        padding: 0; 
        /* 내비바에 버튼이 가려지지 않도록 아래쪽 공간 확보 */
        padding-bottom: 100px;
        }
        .container { max-width: 500px; margin: auto; padding: 15px; }
        .card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #f1f5f9; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; color: #475569; }
        input, select, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #cbd5e1; font-size: 1rem; box-sizing: border-box; margin-bottom: 10px; }
        
        /* 레이아웃 수정 */
        .site-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .checkbox-group { display: flex; align-items: center; font-size: 0.8rem; gap: 5px; cursor: pointer; color: #64748b; }
        .checkbox-group input { width: auto; margin: 0; }

        .chip-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px; }
        .chip-input-group { display: flex; flex: 1; gap: 5px; }
        .chip-input-group input { margin-bottom: 0; flex: 1; padding: 8px; font-size: 0.9rem; }
        .add-btn { background: #334155; color: white; border: none; padding: 8px 12px; border-radius: 8px; font-size: 0.8rem; white-space: nowrap; cursor: pointer; }
        .del-mode-btn { color: #ef4444; font-size: 0.8rem; cursor: pointer; white-space: nowrap; font-weight: bold; }
        
        .chip-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; min-height: 20px; }
        .chip { padding: 8px 14px; background: var(--chip-bg); border-radius: 20px; font-size: 0.9rem; cursor: pointer; border: 1px solid #e2e8f0; transition: 0.2s; }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        .chip.delete-target { background: #fee2e2; color: #ef4444; border: 1px dashed #ef4444; }

        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
        .submit-btn { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 14px; font-size: 1.1rem; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .loading-text { font-size: 0.8rem; color: #94a3b8; font-style: italic; }

        
        /* 💡 추가된 네비게이션 스타일 */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: white; display: flex; border-top: 1px solid #e2e8f0; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; color: #64748b; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        
        /* 💡 스플래시 화면 스타일 추가 */
        #splash-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #E60012; /* 배경을 빨간색으로 */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* 모든 요소보다 위에 표시 */
            transition: opacity 0.5s ease-out;
        }
        .splash-content { text-align: center; }
        .splash-content img { width: 150px; display: block; margin-bottom: 20px; }
        
        /* 로딩 휠 애니메이션 */
        .loader {
            width: 30px; height: 30px;
            border: 3px solid #333;
            border-top: 3px solid #ef4444; /* 타이탄 포인트 컬러 */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
/* 💡 타임라인 그리드: 높이 고정 및 내부 세로 스크롤 허용 */
.timeline-grid {
    display: flex;
    overflow-x: auto;
    overflow-y: hidden; /* 가로 스크롤만 메인으로 */
    max-height: 200px;  /* 👈 너무 길어지지 않게 상한선 설정 */
    gap: 12px;
    padding: 15px 10px;
    background: white;
    border-radius: 16px;
    margin-bottom: 20px;
    scrollbar-width: none;
    align-items: flex-start; /* 막대들을 위쪽으로 정렬 */
}

/* 💡 개별 날짜 기둥: 내부 일정이 많을 경우 자체 스크롤 */
.time-col {
    min-width: 95px;
    max-height: 170px; /* 기둥 높이 제한 */
    overflow-y: auto;  /* 현장이 많으면 기둥 안에서 스크롤 */
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 10px 4px;
    scrollbar-width: none; /* 기둥 스크롤바 숨기기 */
}
.time-col::-webkit-scrollbar { display: none; }

        
/* 💡 화면 전체에 부드러운 스크롤 적용 */
html { scroll-behavior: smooth; }

/* 💡 타임라인 막대 글자색 및 시인성 보강 */
.job-bar {
    width: 90%;
    font-size: 0.85rem;
    padding: 8px 4px;
    margin: 3px 0;
    border-radius: 6px;
    color: white !important; /* 무조건 흰색 */
    text-align: center;
    font-weight: 900;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* 글자 테두리 효과 */
    cursor: pointer;
}

.bar-day { background: #2563eb; }    /* 주간: 파랑 */
.bar-night { background: #1e293b; }  /* 야간: 검정 */

/* 💡 카드 점프 시 하이라이트 효과 */
.schedule-card-item {
    transition: all 0.4s ease;
}
        
.past-btn {
    width: 100%;
    padding: 10px;
    background: #f1f5f9;
    border: 1px dashed #cbd5e1;
    border-radius: 10px;
    margin-bottom: 15px;
    color: #64748b;
    font-size: 0.9rem;
}
        /* 인원 표시 칩 스타일 */
.worker-chip {
    display: inline-block;
    padding: 2px 8px;
    background: #e2e8f0;
    border-radius: 12px;
    font-size: 0.75rem;
    margin-right: 4px;
    color: #475569;
    font-weight: 600;
}

/* 💡 1. [공통] 기본 카드 스타일 (리스트 모드용 마진 유지) */
.card { 
    background: white; 
    border-radius: 16px; 
    padding: 16px; 
    margin-bottom: 16px; 
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); 
    border: 1px solid #f1f5f9; 
    box-sizing: border-box; /* 테두리 포함 크기 고정 */
}

/* 💡 2. [캘린더 전용] 캘린더일 때만 화면 끝까지 확장 */
#schedule-container .calendar-card { 
    padding: 8px 2px !important; 
    margin-left: -5px !important; 
    margin-right: -5px !important;
    width: calc(100% + 10px) !important;
    border-radius: 0; /* 끝까지 꽉 채움 */
    box-shadow: none;
}

/* 💡 3. 리스트 모드(카드뷰)일 때 중복 간섭 차단 */
#schedule-container .card:not(.calendar-card) {
    margin-left: 0;
    margin-right: 0;
    width: 100%;
}

/* 💡 4. 달력 내부 격자 및 칸 최적화 (가로폭 확보) */
#schedule-container div[style*="grid-template-columns"] {
    gap: 1px !important; 
    background: #cbd5e1; 
    border: 1px solid #cbd5e1;
}

.calendar-day-cell {
    background: #ffffff;
    min-height: 95px !important; 
    padding: 2px 1px !important; 
    display: flex;
    flex-direction: column;
}

/* 💡 5. 현장명 막대 가독성 (자간/아이콘 효과) */
.calendar-event-bar {
    font-size: 0.55rem !important; 
    letter-spacing: -0.9px; 
    line-height: 1.1;
    padding: 3px 2px !important;
    border-radius: 3px !important;
    margin-bottom: 2px !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
}

/* 야간/주간 포인트 배선 */
.calendar-event-bar.bar-night { background: #1e293b !important; border-left: 3px solid #facc15 !important; }
.calendar-event-bar.bar-day { background: #2563eb !important; border-left: 3px solid #60a5fa !important; }

/* 💡 6. 기타 UI 효과 */
.sun { color: #ef4444 !important; }
.sat { color: #2563eb !important; }
.is-today { background-color: #eff6ff !important; border: 1.5px solid var(--primary) !important; }
.worker-chip { display: inline-block; padding: 2px 8px; background: #e2e8f0; border-radius: 12px; font-size: 0.75rem; margin-right: 4px; color: #475569; font-weight: 600; }
.schedule-card-item { transition: all 0.4s ease; }

        
        /* 💡 요일 헤더 시인성 보강 */
.calendar-card div[style*="grid-template-columns"] > div:nth-child(1) { color: #ef4444 !important; } /* 일요일 빨강 */
.calendar-card div[style*="grid-template-columns"] > div:nth-child(7) { color: #2563eb !important; } /* 토요일 파랑 */

/* 💡 날짜 숫자 위치 최적화 */
.calendar-day-cell {
    position: relative;
    justify-content: flex-start;
}

/* 💡 스크롤바 숨기기 (타임라인용) */
.timeline-grid::-webkit-scrollbar { display: none; }

        
    </style>
</head>
<body>
    <div id="splash-screen">
        <div class="splash-content">
            <img src="https://github.com/westzero0/titan-work/blob/main/192.png?raw=true" alt="TITAN">
            <div class="loader"></div>
        </div>
    </div>

    <div id="login-screen" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; padding:30px; box-sizing:border-box; flex-direction:column; justify-content:center;">
    <h2 style="text-align:center;">⚡ 타이탄 시스템</h2>
    <p style="text-align:center; color:#666;">본인 이름을 선택하고 로그인하세요.</p>
    
    <select id="login-name-select" class="input-field" style="margin-bottom:15px; height:50px;">
        <option value="">👤 이름을 선택하세요</option>
    </select>
    
    <input type="password" id="login-pw-input" class="input-field" placeholder="🔑 비밀번호 4자리" style="margin-bottom:20px; height:50px; text-align:center;">
    
    <button onclick="handleLogin()" id="login-btn" class="btn" style="height:55px; font-size:1.1rem;">로그인</button>
</div>

    

    <nav class="bottom-nav">
        <div onclick="showPage('log-page')" id="tab-log" class="nav-item active">📝 일보작성</div>
        <div onclick="showPage('schedule-page')" id="tab-sched" class="nav-item">📅 일정확인</div>
    </nav>

    <div class="container">
        <div id="log-page" class="page">
            <h2 style="color: var(--primary); text-align: center;">⚡ 타이탄 작업일보</h2>
            <input type="hidden" id="submitter">

            <div class="card">
                <label>📅 작업 일자</label>
                <input type="date" id="date">
                <label>🏢 거래처</label>
                <div id="client-chips" class="chip-container"><span class="loading-text">데이터를 불러오는 중...</span></div>
                
                <div class="site-header" style="margin-top:15px;">
                    <label style="margin-bottom:0;">🏗️ 현장명</label>
                    <label class="checkbox-group">
                        <input type="checkbox" id="showFinished" onchange="renderSiteChips()"> 완료현장 포함
                    </label>
                </div>
                <input type="text" id="siteSearch" list="site-options" placeholder="현장 검색 또는 직접 입력" oninput="syncSiteSelection()">
                <datalist id="site-options"></datalist>
                <div id="site-chips" class="chip-container"></div>
            </div>

            <div class="card">
                <label>🛠️ 작업 내용</label>
                <textarea id="work" rows="3" placeholder="오늘 작업 내용을 입력하세요"></textarea>
                <div class="row">
                    <div class="col"><label>⏰ 시작</label><select id="start"></select></div>
                    <div class="col"><label>⏰ 종료</label><select id="end"></select></div>
                </div>
                <label>🍱 석식 여부</label>
                <select id="dinner"><option value="X">안먹음 (X)</option><option value="O">먹음 (O)</option></select>
            </div>

            <div class="card">
                <div class="chip-header">
                    <label style="margin-bottom:0;">👥 작업 인원</label>
                    <span onclick="toggleDelMode('member')" id="del-btn-member" class="del-mode-btn">🗑️ 삭제</span>
                </div>
                <div class="chip-input-group">
                    <input type="text" id="add-member-input" placeholder="이름 추가">
                    <button onclick="addItem('member')" class="add-btn">추가</button>
                </div>
                <div id="member-chips" class="chip-container"></div>
            </div>

            <div class="card">
                <div class="chip-header">
                    <label style="margin-bottom:0;">🚗 사용 차량</label>
                    <span onclick="toggleDelMode('car')" id="del-btn-car" class="del-mode-btn">🗑️ 삭제</span>
                </div>
                <div class="chip-input-group">
                    <input type="text" id="add-car-input" placeholder="차량 추가">
                    <button onclick="addItem('car')" class="add-btn">추가</button>
                </div>
                <div id="car-chips" class="chip-container"></div>
            </div>

            <div class="card">
                <div class="chip-header">
                    <label style="margin-bottom:0;">📦 사용 자재 (칩 선택)</label>
                    <span onclick="toggleDelMode('material')" id="del-btn-material" class="del-mode-btn">🗑️ 삭제</span>
                </div>
                <div class="chip-input-group">
                    <input type="text" id="add-material-input" placeholder="자재 이름 추가">
                    <button onclick="addItem('material')" class="add-btn">추가</button>
                </div>
                <div id="material-chips" class="chip-container"></div>
                <textarea id="materialExtra" rows="2" style="margin-top:10px;" placeholder="한번에 입력하려면 여기에 입력하세요."></textarea>
            </div>

            <div class="card">
                <label>💰 경비 금액</label>
                <input type="number" id="expAmount" placeholder="0">
                <div class="chip-header">
                    <label style="margin-bottom:0;">💳 경비 결제자</label>
                    <span onclick="toggleDelMode('payer')" id="del-btn-payer" class="del-mode-btn">🗑️ 삭제</span>
                </div>
                <div class="chip-input-group">
                    <input type="text" id="add-payer-input" placeholder="이름 추가">
                    <button onclick="addItem('payer')" class="add-btn">추가</button>
                </div>
                <div id="payer-chips" class="chip-container"></div>
                <label style="margin-top:10px;">📝 경비 내용</label>
                <input type="text" id="expDetail" placeholder="상세 내용">
                <label>📸 영수증 첨부</label>
                <input type="file" id="receipt" multiple accept="image/*">
            </div>

            <button id="sBtn" class="submit-btn" onclick="send()">🚀 저장 및 카톡 공유</button>
        </div>

<div id="schedule-page" class="page" style="display:none; padding-top: 10px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 5px;">
        <h2 style="color: var(--primary); margin: 0; font-size: 1.2rem; letter-spacing: -1px;">📅 현장 일정</h2>
        
        <div style="display: flex; align-items: center; gap: 8px;">
            <select id="worker-select" onchange="renderView()" style="width: auto; margin: 0; padding: 6px 12px; font-size: 0.85rem; border-radius: 10px; border: 1px solid #cbd5e1; background: white; font-weight: 600;">
                <option value="전체">👤 전체</option>
            </select>
            
            <div id="view-toggle" onclick="toggleView()" style="cursor:pointer; font-size:1.4rem; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">📅</div>
        </div>
    </div>
    
    <div id="timeline-grid" class="timeline-grid" style="margin-bottom: 15px;"></div>

    <div id="schedule-container"></div>
</div>


        
    </div>
    
    <script src="script.js"></script>
 
</body>
</html>
